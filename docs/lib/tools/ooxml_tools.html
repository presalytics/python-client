<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.7.4" />
<title>presalytics.lib.tools.ooxml_tools API documentation</title>
<meta name="description" content="" />
<link href='https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css' rel='stylesheet'>
<link href='https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/8.0.0/sanitize.min.css' rel='stylesheet'>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{font-weight:bold}#index h4 + ul{margin-bottom:.6em}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>presalytics.lib.tools.ooxml_tools</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/tools/ooxml_tools.py#L0-L154" class="git-link">Browse git</a>
</summary>
<pre><code class="python">import datetime
import typing
import logging
import presalytics
import presalytics.story.outline
import presalytics.client.api
import presalytics.lib.widgets.ooxml
import presalytics.lib.themes.ooxml

if typing.TYPE_CHECKING:
    from presalytics.client.presalytics_story import Story
    from presalytics.client.presalytics_ooxml_automation import Document
    from presalytics.story.components import ThemeBase
    from presalytics.story.outline import StoryOutline


logger = logging.getLogger(__name__)


def create_story_from_ooxml_file(filename: str, client_info={}) -&gt; &#39;Story&#39;:
    story: &#39;Story&#39;
    logger.info(&#34;Starting presalytics tool: create_story_from_ooxml_file&#34;)
    logger.info(&#34;Intializing presalytics client.&#34;)
    client = presalytics.Client(**client_info)
    logger.info(&#34;Sending file to presaltyics server for document processing and base story creation&#34;)
    story = client.story.story_post_file(file=filename)
    logger.info(&#34;Creating local instances of file widgets&#34;)
    outline = presalytics.StoryOutline.load(story.outline)
    for i in range(0, len(outline.pages)):
        page = outline.pages[i]
        for j in range(0, len(page.widgets)):
            widget = page.widgets[j]
            logger.info(&#39;Creating OoxmlFileWidget with name &#34;{}&#34;&#39;.format(widget.name))
            inst = presalytics.OoxmlFileWidget.deserialize(widget, **client_info)
            presalytics.COMPONENTS.register(inst)
            logger.info(&#39;Rewriting outline with widget: &#34;{}&#34;&#39;.format(widget.name))
            outline.pages[i].widgets[j] = inst.serialize()
    story.outline = outline.dump()
    return story


def create_outline_from_ooxml_document(story: &#39;Story&#39;,
                                       ooxml_document: &#39;Document&#39;,
                                       title: str = None,
                                       description: str = None,
                                       themes: typing.Sequence[&#39;ThemeBase&#39;] = None,
                                       client_info={}):

    info = presalytics.story.outline.Info(
        revision=0,
        date_created=datetime.datetime.utcnow().isoformat(),
        date_modified=datetime.datetime.utcnow().isoformat(),
        created_by=presalytics.CONFIG.get(&#34;USERNAME&#34;, &#34;&#34;),
        modified_by=presalytics.CONFIG.get(&#34;USERNAME&#34;, &#34;&#34;),
        revision_notes=&#39;Created by via &#34;create_outline_from_ooxml_file&#34; method&#39;
    )

    if description:
        _description = description
    else:
        _description = &#34;&#34;

    pages = create_pages_from_ooxml_document(story, ooxml_document, client_info=client_info)

    if themes:
        _themes = themes
    else:
        ooxml_id = pages[0].widgets[0].data[&#34;document_ooxml_id&#34;]
        _themes = [create_theme_from_ooxml_document(ooxml_id, client_info=client_info)]

    if title:
        _title = title
    else:
        _title = pages[0].widgets[0].name

    outline = presalytics.story.outline.StoryOutline(
        presalytics_story=presalytics.story.outline.get_current_spec_version(),
        info=info,
        pages=pages,
        description=_description,
        title=_title,
        themes=_themes,
        plugins=[]
    )
    return outline


def create_pages_from_ooxml_document(story: &#39;Story&#39;, 
                                     ooxml_document: &#39;Document&#39;,
                                     client_info={}):
    pages = []
    client = presalytics.Client(**client_info)
    child_objects = client.ooxml_automation.documents_childobjects_get_id(ooxml_document.id)
    document_type = client.ooxml_automation.documents_documenttype_typeid_get_type_id(ooxml_document.document_type_id)
    if document_type.file_extension == &#34;pptx&#34;:
        slides_meta = [x for x in child_objects if x.object_type == &#34;Slide.Slides&#34;]
        ep_map = presalytics.OoxmlEndpointMap(presalytics.OoxmlEndpointMap.SLIDE)
        for slide in slides_meta:
            widget = presalytics.OoxmlFileWidget(
                filename=ooxml_document.filename,
                name=slide.entity_name,
                endpoint_map=ep_map,
                object_name=slide.entity_name,
                object_ooxml_id=slide.entity_id,
                document_ooxml_id=ooxml_document.id,
                story_id=story.id,
                client_info=client_info
            )
            widget_kind = &#34;widget-page&#34;
            widget_name = slide.entity_name
            widgets = [widget.serialize()]
            page = presalytics.story.outline.Page(
                kind=widget_kind,
                name=widget_name,
                widgets=widgets
            )
            pages.append(page)
    # TODO: insert excel chart handling here
    return pages


def create_theme_from_ooxml_document(document_id: str, client_info={}):
    client = presalytics.Client(**client_info)
    child_objects = client.ooxml_automation.documents_childobjects_get_id(document_id)
    themes = [x for x in child_objects if x.object_type == &#34;Theme.Themes&#34;]
    if len(themes) &gt; 1:
        slide_no = None
        for theme_data in themes:
            theme_info = client.ooxml_automation.theme_themes_get_id(theme_data.entity_id)
            parent_slide = client.ooxml_automation.slides_slides_get_id(theme_info.slide_id)
            if slide_no is None:
                slide_no = parent_slide.number
                theme_meta = theme_info
            else:
                if parent_slide.number &lt; slide_no:
                    theme_meta = theme_info
                    if parent_slide.number == 0:
                        break
    else:
        theme_meta = client.ooxml_automation.theme_themes_get_id(themes[0].entity_id)
    theme = presalytics.lib.themes.ooxml.OoxmlTheme(
        theme_meta.name, 
        theme_meta.id, 
        client_info=client_info
    )
    return theme.serialize().to_dict()

def get_mime_type_from_filename(client: presalytics.Client, filename) -&gt; typing.Optional[str]:
    doc_types = client.ooxml_automation.documents_documenttype_get()
    file_extension = filename.split(&#34;.&#34;)[-1]
    try:
        return next(x.mime_type for x in doc_types if x.file_extension == file_extension)
    except StopIteration:
        return None
        </code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="presalytics.lib.tools.ooxml_tools.create_outline_from_ooxml_document"><code class="name flex">
<span>def <span class="ident">create_outline_from_ooxml_document</span></span>(<span>story: Story, ooxml_document: Document, title: str = None, description: str = None, themes: Sequence[_ForwardRef('ThemeBase')] = None, client_info={})</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/tools/ooxml_tools.py#L42-L85" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def create_outline_from_ooxml_document(story: &#39;Story&#39;,
                                       ooxml_document: &#39;Document&#39;,
                                       title: str = None,
                                       description: str = None,
                                       themes: typing.Sequence[&#39;ThemeBase&#39;] = None,
                                       client_info={}):

    info = presalytics.story.outline.Info(
        revision=0,
        date_created=datetime.datetime.utcnow().isoformat(),
        date_modified=datetime.datetime.utcnow().isoformat(),
        created_by=presalytics.CONFIG.get(&#34;USERNAME&#34;, &#34;&#34;),
        modified_by=presalytics.CONFIG.get(&#34;USERNAME&#34;, &#34;&#34;),
        revision_notes=&#39;Created by via &#34;create_outline_from_ooxml_file&#34; method&#39;
    )

    if description:
        _description = description
    else:
        _description = &#34;&#34;

    pages = create_pages_from_ooxml_document(story, ooxml_document, client_info=client_info)

    if themes:
        _themes = themes
    else:
        ooxml_id = pages[0].widgets[0].data[&#34;document_ooxml_id&#34;]
        _themes = [create_theme_from_ooxml_document(ooxml_id, client_info=client_info)]

    if title:
        _title = title
    else:
        _title = pages[0].widgets[0].name

    outline = presalytics.story.outline.StoryOutline(
        presalytics_story=presalytics.story.outline.get_current_spec_version(),
        info=info,
        pages=pages,
        description=_description,
        title=_title,
        themes=_themes,
        plugins=[]
    )
    return outline</code></pre>
</details>
</dd>
<dt id="presalytics.lib.tools.ooxml_tools.create_pages_from_ooxml_document"><code class="name flex">
<span>def <span class="ident">create_pages_from_ooxml_document</span></span>(<span>story: Story, ooxml_document: Document, client_info={})</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/tools/ooxml_tools.py#L88-L119" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def create_pages_from_ooxml_document(story: &#39;Story&#39;, 
                                     ooxml_document: &#39;Document&#39;,
                                     client_info={}):
    pages = []
    client = presalytics.Client(**client_info)
    child_objects = client.ooxml_automation.documents_childobjects_get_id(ooxml_document.id)
    document_type = client.ooxml_automation.documents_documenttype_typeid_get_type_id(ooxml_document.document_type_id)
    if document_type.file_extension == &#34;pptx&#34;:
        slides_meta = [x for x in child_objects if x.object_type == &#34;Slide.Slides&#34;]
        ep_map = presalytics.OoxmlEndpointMap(presalytics.OoxmlEndpointMap.SLIDE)
        for slide in slides_meta:
            widget = presalytics.OoxmlFileWidget(
                filename=ooxml_document.filename,
                name=slide.entity_name,
                endpoint_map=ep_map,
                object_name=slide.entity_name,
                object_ooxml_id=slide.entity_id,
                document_ooxml_id=ooxml_document.id,
                story_id=story.id,
                client_info=client_info
            )
            widget_kind = &#34;widget-page&#34;
            widget_name = slide.entity_name
            widgets = [widget.serialize()]
            page = presalytics.story.outline.Page(
                kind=widget_kind,
                name=widget_name,
                widgets=widgets
            )
            pages.append(page)
    # TODO: insert excel chart handling here
    return pages</code></pre>
</details>
</dd>
<dt id="presalytics.lib.tools.ooxml_tools.create_story_from_ooxml_file"><code class="name flex">
<span>def <span class="ident">create_story_from_ooxml_file</span></span>(<span>filename: str, client_info={}) -> 'Story'</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/tools/ooxml_tools.py#L20-L39" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def create_story_from_ooxml_file(filename: str, client_info={}) -&gt; &#39;Story&#39;:
    story: &#39;Story&#39;
    logger.info(&#34;Starting presalytics tool: create_story_from_ooxml_file&#34;)
    logger.info(&#34;Intializing presalytics client.&#34;)
    client = presalytics.Client(**client_info)
    logger.info(&#34;Sending file to presaltyics server for document processing and base story creation&#34;)
    story = client.story.story_post_file(file=filename)
    logger.info(&#34;Creating local instances of file widgets&#34;)
    outline = presalytics.StoryOutline.load(story.outline)
    for i in range(0, len(outline.pages)):
        page = outline.pages[i]
        for j in range(0, len(page.widgets)):
            widget = page.widgets[j]
            logger.info(&#39;Creating OoxmlFileWidget with name &#34;{}&#34;&#39;.format(widget.name))
            inst = presalytics.OoxmlFileWidget.deserialize(widget, **client_info)
            presalytics.COMPONENTS.register(inst)
            logger.info(&#39;Rewriting outline with widget: &#34;{}&#34;&#39;.format(widget.name))
            outline.pages[i].widgets[j] = inst.serialize()
    story.outline = outline.dump()
    return story</code></pre>
</details>
</dd>
<dt id="presalytics.lib.tools.ooxml_tools.create_theme_from_ooxml_document"><code class="name flex">
<span>def <span class="ident">create_theme_from_ooxml_document</span></span>(<span>document_id: str, client_info={})</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/tools/ooxml_tools.py#L122-L146" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def create_theme_from_ooxml_document(document_id: str, client_info={}):
    client = presalytics.Client(**client_info)
    child_objects = client.ooxml_automation.documents_childobjects_get_id(document_id)
    themes = [x for x in child_objects if x.object_type == &#34;Theme.Themes&#34;]
    if len(themes) &gt; 1:
        slide_no = None
        for theme_data in themes:
            theme_info = client.ooxml_automation.theme_themes_get_id(theme_data.entity_id)
            parent_slide = client.ooxml_automation.slides_slides_get_id(theme_info.slide_id)
            if slide_no is None:
                slide_no = parent_slide.number
                theme_meta = theme_info
            else:
                if parent_slide.number &lt; slide_no:
                    theme_meta = theme_info
                    if parent_slide.number == 0:
                        break
    else:
        theme_meta = client.ooxml_automation.theme_themes_get_id(themes[0].entity_id)
    theme = presalytics.lib.themes.ooxml.OoxmlTheme(
        theme_meta.name, 
        theme_meta.id, 
        client_info=client_info
    )
    return theme.serialize().to_dict()</code></pre>
</details>
</dd>
<dt id="presalytics.lib.tools.ooxml_tools.get_mime_type_from_filename"><code class="name flex">
<span>def <span class="ident">get_mime_type_from_filename</span></span>(<span>client: <a title="presalytics.client.api.Client" href="/python-client/presalytics/client/api.html#presalytics.client.api.Client">Client</a>, filename) -> Union[str, NoneType]</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/tools/ooxml_tools.py#L148-L154" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def get_mime_type_from_filename(client: presalytics.Client, filename) -&gt; typing.Optional[str]:
    doc_types = client.ooxml_automation.documents_documenttype_get()
    file_extension = filename.split(&#34;.&#34;)[-1]
    try:
        return next(x.mime_type for x in doc_types if x.file_extension == file_extension)
    except StopIteration:
        return None</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="presalytics.lib.tools" href="/python-client/presalytics/lib/tools/index.html">presalytics.lib.tools</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="presalytics.lib.tools.ooxml_tools.create_outline_from_ooxml_document" href="/python-client/presalytics/lib/tools/ooxml_tools.html#presalytics.lib.tools.ooxml_tools.create_outline_from_ooxml_document">create_outline_from_ooxml_document</a></code></li>
<li><code><a title="presalytics.lib.tools.ooxml_tools.create_pages_from_ooxml_document" href="/python-client/presalytics/lib/tools/ooxml_tools.html#presalytics.lib.tools.ooxml_tools.create_pages_from_ooxml_document">create_pages_from_ooxml_document</a></code></li>
<li><code><a title="presalytics.lib.tools.ooxml_tools.create_story_from_ooxml_file" href="/python-client/presalytics/lib/tools/ooxml_tools.html#presalytics.lib.tools.ooxml_tools.create_story_from_ooxml_file">create_story_from_ooxml_file</a></code></li>
<li><code><a title="presalytics.lib.tools.ooxml_tools.create_theme_from_ooxml_document" href="/python-client/presalytics/lib/tools/ooxml_tools.html#presalytics.lib.tools.ooxml_tools.create_theme_from_ooxml_document">create_theme_from_ooxml_document</a></code></li>
<li><code><a title="presalytics.lib.tools.ooxml_tools.get_mime_type_from_filename" href="/python-client/presalytics/lib/tools/ooxml_tools.html#presalytics.lib.tools.ooxml_tools.get_mime_type_from_filename">get_mime_type_from_filename</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.7.4</a>.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>