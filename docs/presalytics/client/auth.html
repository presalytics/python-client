<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.7.4" />
<title>presalytics.client.auth API documentation</title>
<meta name="description" content="" />
<link href='https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css' rel='stylesheet'>
<link href='https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/8.0.0/sanitize.min.css' rel='stylesheet'>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{font-weight:bold}#index h4 + ul{margin-bottom:.6em}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>presalytics.client.auth</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/client/auth.py#L0-L240" class="git-link">Browse git</a>
</summary>
<pre><code class="python">import json
import logging
import pkg_resources
import sys
import weakref
import dateutil
import dateutil.parser
import datetime
import six
import posixpath
import presalytics
import presalytics.lib.exceptions
import presalytics.lib.constants
import typing
if typing.TYPE_CHECKING:
    from presalytics.client.api import Client


logger = logging.getLogger(__name__)


class TokenUtil(object):
    def __init__(self, token=None, token_file=None, token_cache=False):
        self.token_cache = token_cache
        if token_file is None:
            self.token_file = presalytics.lib.constants.TOKEN_FILE
        else:
            self.token_file = token_file
        try:
            self._load_token_file()
        except Exception:
            pass
        if token is not None:
            try:
                self.process_token(token)    
                if self.token_cache:
                    self._put_token_file()
            except Exception:
                raise presalytics.lib.exceptions.MisConfiguredTokenException()
        else:
            self.token = {}

    def is_api_access_token_expired(self):
        try:
            if not self.token.get(&#39;access_token_expire_time&#39;, None):
                if self.token.get(&#39;access_token&#39;, None):
                    return False  # If expire time unknown, instruct client to call endpoint
                else:
                    return True  # If no token, instruct client to acquire token
            token_expiry = self.token[&#39;access_token_expire_time&#39;]
            if isinstance(token_expiry, datetime.datetime):
                expire_datetime = token_expiry.astimezone(datetime.timezone.utc)
            elif isinstance(token_expiry, str):
                expire_datetime = dateutil.parser.parse(self.token[&#39;access_token_expire_time&#39;]).astimezone(datetime.timezone.utc)
            else:
                logger.error(&#34;Token expire time not of type str (isoformat) or datetime.datetime&#34;)
                return True  # Get a new token on type error
            if expire_datetime &lt; datetime.datetime.utcnow().astimezone(datetime.timezone.utc):
                return True
            else:
                return False
        except Exception as ex:
            logger.exception(ex)
            return True # Get a new token on unknown errors

    def _load_token_file(self):
        try:
            if self.token_cache:
                self.token = self.load_token_from_file(self.token_file)
        except Exception:
            logger.error(&#34;Unable to load token from cache.  If you do intend to cache tokens, use configuration CACHE_TOKENS=False&#34;)

    def _put_token_file(self):
        try:
            if self.token_cache:
                self.put_token_file(self.token, self.token_file)
        except Exception:
            logger.error(&#34;Failed to cache token.  Likely a write permissions error for the filesystem.&#34;)

    def process_token(self, token):
        self.token = {
            &#39;access_token&#39;: token[&#39;access_token&#39;]
        }
        if not token.get(&#39;access_token_expire_time&#39;, None):
            if token.get(&#39;expires_in&#39;, None):
                access_token_expire_time = datetime.datetime.utcnow().astimezone(datetime.timezone.utc) + datetime.timedelta(seconds=token[&#39;expires_in&#39;])
            else:
                pass    # TODO: add logic to introspect token for expire time 
        else:
            access_token_expire_time = token[&#34;access_token_expire_time&#34;]
        if access_token_expire_time:
            self.token.update({
                &#34;access_token_expire_time&#34;: access_token_expire_time
            })
        if token.get(&#39;refresh_token&#39;, None):
            self.token.update({
                &#34;refresh_token&#34;: token[&#34;refresh_token&#34;]
            })
        return self.token

    @staticmethod
    def put_token_file(token, token_filepath):
        with open(token_filepath, mode=&#39;w+&#39;) as newtoken:
            json.dump(token, newtoken)

    @staticmethod
    def load_token_from_file(token_filepath):
        with open(token_filepath, &#39;r&#39;) as token_file:
            token = json.load(token_file)
        return token


class AuthenticationMixIn(object):
    def __init__(self, parent: &#39;Client&#39;, ignore_api_exceptions=False, **kwargs):
        self._ignore_api_exceptions = ignore_api_exceptions
        self.parent = weakref.ref(parent)
        super(AuthenticationMixIn, self).__init__()
        self.update_configuration()

    def call_api(
            self, resource_path, method,
            path_params=None, query_params=None, header_params=None,
            body=None, post_params=None, files=None,
            response_type=None, auth_settings=None, async_req=None,
            _return_http_data_only=None, collection_formats=None,
            _preload_content=None, _request_timeout=None, _host=None):
        &#34;&#34;&#34;
        Overriding call_api to force token check, refresh on each api call,
        rather than at class initialized (good for ipython notebooks)
        &#34;&#34;&#34;
        if self.parent() is None:
            message = &#34;&#34;&#34;
            Missing reference to Client class.  Client was like garbage collected by the intepreter.\n  
            Please initialize the Client class on its own line to avoid this error.  For example:\n\n
            client = presalytics.Client()\n
            story = client.story.story_id_get(story_id)
            &#34;&#34;&#34;
            raise presalytics.lib.exceptions.InvalidConfigurationError(message=message)
        auth_header = self.parent().get_auth_header()
        if header_params is not None:
            header_params.update(auth_header)
        else:
            header_params = auth_header
        if not header_params.get(&#34;X-Request_Id&#34;):
            req_id = self.parent().get_request_id_header()
            header_params.update(req_id)
        request_id = header_params.get(&#34;X-Request-Id&#34;)
        try:

            endpoint = self.configuration.host + resource_path
            logger.info(&#34;Sending {0} message to {1}. Request Id: {2}&#34;.format(method, endpoint, request_id))
            call_args = (
                resource_path, 
                method, 
                path_params,
                query_params, 
                header_params, 
                body, 
                post_params, 
                files, 
                response_type,
                auth_settings, 
                async_req, 
                _return_http_data_only, 
                collection_formats, 
                _preload_content,
                _request_timeout, 
                _host
            )
            response = super(AuthenticationMixIn, self).call_api(*call_args)
            logger.info(&#34;{0} response received from {1}&#34;.format(method, endpoint))
            return response
        except Exception as e:
            if type(e).__name__ == &#34;ApiException&#34;:
                try:
                    d = json.loads(e.body)
                    addendum = &#34; Host: {0}; Path: {1}; Method: {2}; Request Id: {3}&#34;.format(self.configuration.host, resource_path, method, request_id)
                    try:
                        d[&#34;detail&#34;] = d[&#34;detail&#34;] + addendum
                    except TypeError:
                        d = e.body + addendum
                    e.body = json.dumps(d)
                    logging.error(d)
                    if d[&#34;status&#34;] == 401:
                        logging.debug(&#34;Refeshing token from unauathorized call and retrying&#34;)
                        self.parent().refresh_token()
                        return super(AuthenticationMixIn, self).call_api(*call_args)
                except Exception:
                    pass
                if self._ignore_api_exceptions:
                    return e.body, e.status, e.headers
                else:
                    raise presalytics.lib.exceptions.ApiException(default_exception=e)
            else:
                t, v, tb = sys.exc_info()
                six.reraise(t, v, tb)

    def update_configuration(self):
        &#34;&#34;&#34;
        updates the configuration from the base api client to parameters contained in the config file.
        base api client must be initialized prior to calling this method (i.e., self.configuration cannot equal None),
        so that configuration can automatically inherit default values.
        Mostly used for debugging purposes, but self-hosted API endpoints may require injection of these parameters
        &#34;&#34;&#34;
        if self.configuration is None:
            raise presalytics.lib.exceptions.MissingConfigException(&#34;Base API not yet configured, please reconstruct API initialization&#34;)
        self.user_agent = AuthenticationMixIn._get_user_agent
        if presalytics.CONFIG.get(&#34;HOSTS&#34;, None):
            self.set_host(presalytics.CONFIG.get(&#39;HOSTS&#39;))

    @staticmethod
    def get_user_agent():
        try:
            VER = pkg_resources.require(&#34;presalytics&#34;)[0].version
        except Exception:
            VER = &#39;build&#39;
        return &#34;presalytics-python-client/{0}&#34;.format(VER)

    _get_user_agent = get_user_agent.__func__()

    def set_host(self, hosts_dict):
        for parent_cls in self.__class__.__bases__:
            if parent_cls.__name__ == &#39;ApiClient&#39;:
                for k, v in hosts_dict.items():
                    if k.lower() in parent_cls.__module__:
                        host_key = k
                        break
        try:
            self.configuration.host = hosts_dict[host_key]
        except (KeyError, UnboundLocalError):
            pass

    def _ApiClient__deserialize_datetime(self, string):
        &#34;&#34;&#34;Overwrites generated function to include UTC timezone on datetime object
        needs to account for name-mangling in parent class
        The string should be in iso8601 datetime format.

        :param string: str.
        :return: datetime.
        &#34;&#34;&#34;
        return super()._ApiClient__deserialize_datetime(string).astimezone(datetime.timezone.utc)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="presalytics.client.auth.TokenUtil"><code class="flex name class">
<span>class <span class="ident">TokenUtil</span></span>
<span>(</span><span>token=None, token_file=None, token_cache=False)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/client/auth.py#L22-L110" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class TokenUtil(object):
    def __init__(self, token=None, token_file=None, token_cache=False):
        self.token_cache = token_cache
        if token_file is None:
            self.token_file = presalytics.lib.constants.TOKEN_FILE
        else:
            self.token_file = token_file
        try:
            self._load_token_file()
        except Exception:
            pass
        if token is not None:
            try:
                self.process_token(token)    
                if self.token_cache:
                    self._put_token_file()
            except Exception:
                raise presalytics.lib.exceptions.MisConfiguredTokenException()
        else:
            self.token = {}

    def is_api_access_token_expired(self):
        try:
            if not self.token.get(&#39;access_token_expire_time&#39;, None):
                if self.token.get(&#39;access_token&#39;, None):
                    return False  # If expire time unknown, instruct client to call endpoint
                else:
                    return True  # If no token, instruct client to acquire token
            token_expiry = self.token[&#39;access_token_expire_time&#39;]
            if isinstance(token_expiry, datetime.datetime):
                expire_datetime = token_expiry.astimezone(datetime.timezone.utc)
            elif isinstance(token_expiry, str):
                expire_datetime = dateutil.parser.parse(self.token[&#39;access_token_expire_time&#39;]).astimezone(datetime.timezone.utc)
            else:
                logger.error(&#34;Token expire time not of type str (isoformat) or datetime.datetime&#34;)
                return True  # Get a new token on type error
            if expire_datetime &lt; datetime.datetime.utcnow().astimezone(datetime.timezone.utc):
                return True
            else:
                return False
        except Exception as ex:
            logger.exception(ex)
            return True # Get a new token on unknown errors

    def _load_token_file(self):
        try:
            if self.token_cache:
                self.token = self.load_token_from_file(self.token_file)
        except Exception:
            logger.error(&#34;Unable to load token from cache.  If you do intend to cache tokens, use configuration CACHE_TOKENS=False&#34;)

    def _put_token_file(self):
        try:
            if self.token_cache:
                self.put_token_file(self.token, self.token_file)
        except Exception:
            logger.error(&#34;Failed to cache token.  Likely a write permissions error for the filesystem.&#34;)

    def process_token(self, token):
        self.token = {
            &#39;access_token&#39;: token[&#39;access_token&#39;]
        }
        if not token.get(&#39;access_token_expire_time&#39;, None):
            if token.get(&#39;expires_in&#39;, None):
                access_token_expire_time = datetime.datetime.utcnow().astimezone(datetime.timezone.utc) + datetime.timedelta(seconds=token[&#39;expires_in&#39;])
            else:
                pass    # TODO: add logic to introspect token for expire time 
        else:
            access_token_expire_time = token[&#34;access_token_expire_time&#34;]
        if access_token_expire_time:
            self.token.update({
                &#34;access_token_expire_time&#34;: access_token_expire_time
            })
        if token.get(&#39;refresh_token&#39;, None):
            self.token.update({
                &#34;refresh_token&#34;: token[&#34;refresh_token&#34;]
            })
        return self.token

    @staticmethod
    def put_token_file(token, token_filepath):
        with open(token_filepath, mode=&#39;w+&#39;) as newtoken:
            json.dump(token, newtoken)

    @staticmethod
    def load_token_from_file(token_filepath):
        with open(token_filepath, &#39;r&#39;) as token_file:
            token = json.load(token_file)
        return token</code></pre>
</details>
<h3>Static methods</h3>
<dl>
<dt id="presalytics.client.auth.TokenUtil.put_token_file"><code class="name flex">
<span>def <span class="ident">put_token_file</span></span>(<span>token, token_filepath)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/client/auth.py#L101-L104" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@staticmethod
def put_token_file(token, token_filepath):
    with open(token_filepath, mode=&#39;w+&#39;) as newtoken:
        json.dump(token, newtoken)</code></pre>
</details>
</dd>
<dt id="presalytics.client.auth.TokenUtil.load_token_from_file"><code class="name flex">
<span>def <span class="ident">load_token_from_file</span></span>(<span>token_filepath)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/client/auth.py#L106-L110" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@staticmethod
def load_token_from_file(token_filepath):
    with open(token_filepath, &#39;r&#39;) as token_file:
        token = json.load(token_file)
    return token</code></pre>
</details>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="presalytics.client.auth.TokenUtil.is_api_access_token_expired"><code class="name flex">
<span>def <span class="ident">is_api_access_token_expired</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/client/auth.py#L43-L64" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def is_api_access_token_expired(self):
    try:
        if not self.token.get(&#39;access_token_expire_time&#39;, None):
            if self.token.get(&#39;access_token&#39;, None):
                return False  # If expire time unknown, instruct client to call endpoint
            else:
                return True  # If no token, instruct client to acquire token
        token_expiry = self.token[&#39;access_token_expire_time&#39;]
        if isinstance(token_expiry, datetime.datetime):
            expire_datetime = token_expiry.astimezone(datetime.timezone.utc)
        elif isinstance(token_expiry, str):
            expire_datetime = dateutil.parser.parse(self.token[&#39;access_token_expire_time&#39;]).astimezone(datetime.timezone.utc)
        else:
            logger.error(&#34;Token expire time not of type str (isoformat) or datetime.datetime&#34;)
            return True  # Get a new token on type error
        if expire_datetime &lt; datetime.datetime.utcnow().astimezone(datetime.timezone.utc):
            return True
        else:
            return False
    except Exception as ex:
        logger.exception(ex)
        return True # Get a new token on unknown errors</code></pre>
</details>
</dd>
<dt id="presalytics.client.auth.TokenUtil.process_token"><code class="name flex">
<span>def <span class="ident">process_token</span></span>(<span>self, token)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/client/auth.py#L80-L99" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def process_token(self, token):
    self.token = {
        &#39;access_token&#39;: token[&#39;access_token&#39;]
    }
    if not token.get(&#39;access_token_expire_time&#39;, None):
        if token.get(&#39;expires_in&#39;, None):
            access_token_expire_time = datetime.datetime.utcnow().astimezone(datetime.timezone.utc) + datetime.timedelta(seconds=token[&#39;expires_in&#39;])
        else:
            pass    # TODO: add logic to introspect token for expire time 
    else:
        access_token_expire_time = token[&#34;access_token_expire_time&#34;]
    if access_token_expire_time:
        self.token.update({
            &#34;access_token_expire_time&#34;: access_token_expire_time
        })
    if token.get(&#39;refresh_token&#39;, None):
        self.token.update({
            &#34;refresh_token&#34;: token[&#34;refresh_token&#34;]
        })
    return self.token</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="presalytics.client.auth.AuthenticationMixIn"><code class="flex name class">
<span>class <span class="ident">AuthenticationMixIn</span></span>
<span>(</span><span>parent, ignore_api_exceptions=False, **kwargs)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/client/auth.py#L113-L241" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class AuthenticationMixIn(object):
    def __init__(self, parent: &#39;Client&#39;, ignore_api_exceptions=False, **kwargs):
        self._ignore_api_exceptions = ignore_api_exceptions
        self.parent = weakref.ref(parent)
        super(AuthenticationMixIn, self).__init__()
        self.update_configuration()

    def call_api(
            self, resource_path, method,
            path_params=None, query_params=None, header_params=None,
            body=None, post_params=None, files=None,
            response_type=None, auth_settings=None, async_req=None,
            _return_http_data_only=None, collection_formats=None,
            _preload_content=None, _request_timeout=None, _host=None):
        &#34;&#34;&#34;
        Overriding call_api to force token check, refresh on each api call,
        rather than at class initialized (good for ipython notebooks)
        &#34;&#34;&#34;
        if self.parent() is None:
            message = &#34;&#34;&#34;
            Missing reference to Client class.  Client was like garbage collected by the intepreter.\n  
            Please initialize the Client class on its own line to avoid this error.  For example:\n\n
            client = presalytics.Client()\n
            story = client.story.story_id_get(story_id)
            &#34;&#34;&#34;
            raise presalytics.lib.exceptions.InvalidConfigurationError(message=message)
        auth_header = self.parent().get_auth_header()
        if header_params is not None:
            header_params.update(auth_header)
        else:
            header_params = auth_header
        if not header_params.get(&#34;X-Request_Id&#34;):
            req_id = self.parent().get_request_id_header()
            header_params.update(req_id)
        request_id = header_params.get(&#34;X-Request-Id&#34;)
        try:

            endpoint = self.configuration.host + resource_path
            logger.info(&#34;Sending {0} message to {1}. Request Id: {2}&#34;.format(method, endpoint, request_id))
            call_args = (
                resource_path, 
                method, 
                path_params,
                query_params, 
                header_params, 
                body, 
                post_params, 
                files, 
                response_type,
                auth_settings, 
                async_req, 
                _return_http_data_only, 
                collection_formats, 
                _preload_content,
                _request_timeout, 
                _host
            )
            response = super(AuthenticationMixIn, self).call_api(*call_args)
            logger.info(&#34;{0} response received from {1}&#34;.format(method, endpoint))
            return response
        except Exception as e:
            if type(e).__name__ == &#34;ApiException&#34;:
                try:
                    d = json.loads(e.body)
                    addendum = &#34; Host: {0}; Path: {1}; Method: {2}; Request Id: {3}&#34;.format(self.configuration.host, resource_path, method, request_id)
                    try:
                        d[&#34;detail&#34;] = d[&#34;detail&#34;] + addendum
                    except TypeError:
                        d = e.body + addendum
                    e.body = json.dumps(d)
                    logging.error(d)
                    if d[&#34;status&#34;] == 401:
                        logging.debug(&#34;Refeshing token from unauathorized call and retrying&#34;)
                        self.parent().refresh_token()
                        return super(AuthenticationMixIn, self).call_api(*call_args)
                except Exception:
                    pass
                if self._ignore_api_exceptions:
                    return e.body, e.status, e.headers
                else:
                    raise presalytics.lib.exceptions.ApiException(default_exception=e)
            else:
                t, v, tb = sys.exc_info()
                six.reraise(t, v, tb)

    def update_configuration(self):
        &#34;&#34;&#34;
        updates the configuration from the base api client to parameters contained in the config file.
        base api client must be initialized prior to calling this method (i.e., self.configuration cannot equal None),
        so that configuration can automatically inherit default values.
        Mostly used for debugging purposes, but self-hosted API endpoints may require injection of these parameters
        &#34;&#34;&#34;
        if self.configuration is None:
            raise presalytics.lib.exceptions.MissingConfigException(&#34;Base API not yet configured, please reconstruct API initialization&#34;)
        self.user_agent = AuthenticationMixIn._get_user_agent
        if presalytics.CONFIG.get(&#34;HOSTS&#34;, None):
            self.set_host(presalytics.CONFIG.get(&#39;HOSTS&#39;))

    @staticmethod
    def get_user_agent():
        try:
            VER = pkg_resources.require(&#34;presalytics&#34;)[0].version
        except Exception:
            VER = &#39;build&#39;
        return &#34;presalytics-python-client/{0}&#34;.format(VER)

    _get_user_agent = get_user_agent.__func__()

    def set_host(self, hosts_dict):
        for parent_cls in self.__class__.__bases__:
            if parent_cls.__name__ == &#39;ApiClient&#39;:
                for k, v in hosts_dict.items():
                    if k.lower() in parent_cls.__module__:
                        host_key = k
                        break
        try:
            self.configuration.host = hosts_dict[host_key]
        except (KeyError, UnboundLocalError):
            pass

    def _ApiClient__deserialize_datetime(self, string):
        &#34;&#34;&#34;Overwrites generated function to include UTC timezone on datetime object
        needs to account for name-mangling in parent class
        The string should be in iso8601 datetime format.

        :param string: str.
        :return: datetime.
        &#34;&#34;&#34;
        return super()._ApiClient__deserialize_datetime(string).astimezone(datetime.timezone.utc)</code></pre>
</details>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="presalytics.client.api.DocConverterApiClientWithAuth" href="/python-client/presalytics/client/api.html#presalytics.client.api.DocConverterApiClientWithAuth">DocConverterApiClientWithAuth</a></li>
<li><a title="presalytics.client.api.OoxmlAutomationApiClientWithAuth" href="/python-client/presalytics/client/api.html#presalytics.client.api.OoxmlAutomationApiClientWithAuth">OoxmlAutomationApiClientWithAuth</a></li>
<li><a title="presalytics.client.api.StoryApiClientWithAuth" href="/python-client/presalytics/client/api.html#presalytics.client.api.StoryApiClientWithAuth">StoryApiClientWithAuth</a></li>
</ul>
<h3>Static methods</h3>
<dl>
<dt id="presalytics.client.auth.AuthenticationMixIn.get_user_agent"><code class="name flex">
<span>def <span class="ident">get_user_agent</span></span>(<span>)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/client/auth.py#L211-L217" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@staticmethod
def get_user_agent():
    try:
        VER = pkg_resources.require(&#34;presalytics&#34;)[0].version
    except Exception:
        VER = &#39;build&#39;
    return &#34;presalytics-python-client/{0}&#34;.format(VER)</code></pre>
</details>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="presalytics.client.auth.AuthenticationMixIn.call_api"><code class="name flex">
<span>def <span class="ident">call_api</span></span>(<span>self, resource_path, method, path_params=None, query_params=None, header_params=None, body=None, post_params=None, files=None, response_type=None, auth_settings=None, async_req=None, collection_formats=None)</span>
</code></dt>
<dd>
<section class="desc"><p>Overriding call_api to force token check, refresh on each api call,
rather than at class initialized (good for ipython notebooks)</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/client/auth.py#L120-L196" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def call_api(
        self, resource_path, method,
        path_params=None, query_params=None, header_params=None,
        body=None, post_params=None, files=None,
        response_type=None, auth_settings=None, async_req=None,
        _return_http_data_only=None, collection_formats=None,
        _preload_content=None, _request_timeout=None, _host=None):
    &#34;&#34;&#34;
    Overriding call_api to force token check, refresh on each api call,
    rather than at class initialized (good for ipython notebooks)
    &#34;&#34;&#34;
    if self.parent() is None:
        message = &#34;&#34;&#34;
        Missing reference to Client class.  Client was like garbage collected by the intepreter.\n  
        Please initialize the Client class on its own line to avoid this error.  For example:\n\n
        client = presalytics.Client()\n
        story = client.story.story_id_get(story_id)
        &#34;&#34;&#34;
        raise presalytics.lib.exceptions.InvalidConfigurationError(message=message)
    auth_header = self.parent().get_auth_header()
    if header_params is not None:
        header_params.update(auth_header)
    else:
        header_params = auth_header
    if not header_params.get(&#34;X-Request_Id&#34;):
        req_id = self.parent().get_request_id_header()
        header_params.update(req_id)
    request_id = header_params.get(&#34;X-Request-Id&#34;)
    try:

        endpoint = self.configuration.host + resource_path
        logger.info(&#34;Sending {0} message to {1}. Request Id: {2}&#34;.format(method, endpoint, request_id))
        call_args = (
            resource_path, 
            method, 
            path_params,
            query_params, 
            header_params, 
            body, 
            post_params, 
            files, 
            response_type,
            auth_settings, 
            async_req, 
            _return_http_data_only, 
            collection_formats, 
            _preload_content,
            _request_timeout, 
            _host
        )
        response = super(AuthenticationMixIn, self).call_api(*call_args)
        logger.info(&#34;{0} response received from {1}&#34;.format(method, endpoint))
        return response
    except Exception as e:
        if type(e).__name__ == &#34;ApiException&#34;:
            try:
                d = json.loads(e.body)
                addendum = &#34; Host: {0}; Path: {1}; Method: {2}; Request Id: {3}&#34;.format(self.configuration.host, resource_path, method, request_id)
                try:
                    d[&#34;detail&#34;] = d[&#34;detail&#34;] + addendum
                except TypeError:
                    d = e.body + addendum
                e.body = json.dumps(d)
                logging.error(d)
                if d[&#34;status&#34;] == 401:
                    logging.debug(&#34;Refeshing token from unauathorized call and retrying&#34;)
                    self.parent().refresh_token()
                    return super(AuthenticationMixIn, self).call_api(*call_args)
            except Exception:
                pass
            if self._ignore_api_exceptions:
                return e.body, e.status, e.headers
            else:
                raise presalytics.lib.exceptions.ApiException(default_exception=e)
        else:
            t, v, tb = sys.exc_info()
            six.reraise(t, v, tb)</code></pre>
</details>
</dd>
<dt id="presalytics.client.auth.AuthenticationMixIn.update_configuration"><code class="name flex">
<span>def <span class="ident">update_configuration</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>updates the configuration from the base api client to parameters contained in the config file.
base api client must be initialized prior to calling this method (i.e., self.configuration cannot equal None),
so that configuration can automatically inherit default values.
Mostly used for debugging purposes, but self-hosted API endpoints may require injection of these parameters</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/client/auth.py#L198-L209" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def update_configuration(self):
    &#34;&#34;&#34;
    updates the configuration from the base api client to parameters contained in the config file.
    base api client must be initialized prior to calling this method (i.e., self.configuration cannot equal None),
    so that configuration can automatically inherit default values.
    Mostly used for debugging purposes, but self-hosted API endpoints may require injection of these parameters
    &#34;&#34;&#34;
    if self.configuration is None:
        raise presalytics.lib.exceptions.MissingConfigException(&#34;Base API not yet configured, please reconstruct API initialization&#34;)
    self.user_agent = AuthenticationMixIn._get_user_agent
    if presalytics.CONFIG.get(&#34;HOSTS&#34;, None):
        self.set_host(presalytics.CONFIG.get(&#39;HOSTS&#39;))</code></pre>
</details>
</dd>
<dt id="presalytics.client.auth.AuthenticationMixIn.set_host"><code class="name flex">
<span>def <span class="ident">set_host</span></span>(<span>self, hosts_dict)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/client/auth.py#L221-L231" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def set_host(self, hosts_dict):
    for parent_cls in self.__class__.__bases__:
        if parent_cls.__name__ == &#39;ApiClient&#39;:
            for k, v in hosts_dict.items():
                if k.lower() in parent_cls.__module__:
                    host_key = k
                    break
    try:
        self.configuration.host = hosts_dict[host_key]
    except (KeyError, UnboundLocalError):
        pass</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="presalytics.client" href="/python-client/presalytics/client/index.html">presalytics.client</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="presalytics.client.auth.TokenUtil" href="/python-client/presalytics/client/auth.html#presalytics.client.auth.TokenUtil">TokenUtil</a></code></h4>
<ul class="">
<li><code><a title="presalytics.client.auth.TokenUtil.put_token_file" href="/python-client/presalytics/client/auth.html#presalytics.client.auth.TokenUtil.put_token_file">put_token_file</a></code></li>
<li><code><a title="presalytics.client.auth.TokenUtil.load_token_from_file" href="/python-client/presalytics/client/auth.html#presalytics.client.auth.TokenUtil.load_token_from_file">load_token_from_file</a></code></li>
<li><code><a title="presalytics.client.auth.TokenUtil.is_api_access_token_expired" href="/python-client/presalytics/client/auth.html#presalytics.client.auth.TokenUtil.is_api_access_token_expired">is_api_access_token_expired</a></code></li>
<li><code><a title="presalytics.client.auth.TokenUtil.process_token" href="/python-client/presalytics/client/auth.html#presalytics.client.auth.TokenUtil.process_token">process_token</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="presalytics.client.auth.AuthenticationMixIn" href="/python-client/presalytics/client/auth.html#presalytics.client.auth.AuthenticationMixIn">AuthenticationMixIn</a></code></h4>
<ul class="">
<li><code><a title="presalytics.client.auth.AuthenticationMixIn.get_user_agent" href="/python-client/presalytics/client/auth.html#presalytics.client.auth.AuthenticationMixIn.get_user_agent">get_user_agent</a></code></li>
<li><code><a title="presalytics.client.auth.AuthenticationMixIn.call_api" href="/python-client/presalytics/client/auth.html#presalytics.client.auth.AuthenticationMixIn.call_api">call_api</a></code></li>
<li><code><a title="presalytics.client.auth.AuthenticationMixIn.update_configuration" href="/python-client/presalytics/client/auth.html#presalytics.client.auth.AuthenticationMixIn.update_configuration">update_configuration</a></code></li>
<li><code><a title="presalytics.client.auth.AuthenticationMixIn.set_host" href="/python-client/presalytics/client/auth.html#presalytics.client.auth.AuthenticationMixIn.set_host">set_host</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.7.4</a>.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>