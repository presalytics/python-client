<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.7.4" />
<title>presalytics.lib.tools.ooxml_tools API documentation</title>
<meta name="description" content="" />
<link href='https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css' rel='stylesheet'>
<link href='https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/8.0.0/sanitize.min.css' rel='stylesheet'>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{font-weight:bold}#index h4 + ul{margin-bottom:.6em}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>presalytics.lib.tools.ooxml_tools</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/tools/ooxml_tools.py#L0-L303" class="git-link">Browse git</a>
</summary>
<pre><code class="python">import datetime
import typing
import logging
import presalytics
import presalytics.story.outline
import presalytics.client.api
import presalytics.lib.widgets.ooxml
import presalytics.lib.themes.ooxml

if typing.TYPE_CHECKING:
    from presalytics.client.presalytics_story import Story
    from presalytics.client.presalytics_ooxml_automation import Document
    from presalytics.story.components import ThemeBase
    from presalytics.story.outline import StoryOutline


logger = logging.getLogger(__name__)


def add_ooxml_document_to_story(story_id, new_document_filepath, replace_id=None, username=None, password=None):
    &#34;&#34;&#34;
    Utility method for asscoiating a new Document in the Presalytics API Ooxml Automation service
    with a Story.  

    Parameters
    ----------
    story_id: str
        The Presalytics API Story service Id for for the story

    new_document_filepath str
        The local filepath to the document tha you want to associate with the story

    replace_id: str, option
        If you want to replace a document, this the documents Ooxml Automation service Id  
        
        Passing this value will also update the references to Ooxml Automation
        service Document object in the Story Outline.  This is a good option if you have
        not made significant changes to the new version of the document.  Widgets may 
        fail to render if more than minor changes are made to the object tree.

    username: str, option
        Presalytics API username.  Defaults to workspace username.

    password: str, option
        Presalytics API password. 
    &#34;&#34;&#34;

    client = presalytics.client.api.Client(username=username, password=password)
    if story_id == &#34;empty&#34; or not story_id:
        message = &#34;The story_id must not be empty&#34;
        raise presalytics.lib.exceptions.InvalidArgumentException(message)
    replace = True if replace_id else False
    story = client.story.story_id_file_post(story_id, file=new_document_filepath, replace_existing=replace, obsolete_id=replace_id)

def create_story_from_ooxml_file(filename: str, client_info={}) -&gt; &#39;Story&#39;:
    &#34;&#34;&#34;
    Utility Method for building stories into the Presalytics API directly from a Presentation or Spreadsheet file. 

    Parameters
    ----------
    filename : str
        A string contain the local path to a presenation or spreadsheet object.

    client_info : dict, optional
        A dictionary containing arguments that will be unpacked and passed to a `presalytics.client.api.Client` object on intialization. 
        This dictionary can include the `token`, `cache_tokens`, `delegate_login` values.  See `presalytics.client.api.Client` for more information.

    Returns:
    ----------
    A `presalytics.client.presalytics_story.models.story.Story` containing information about the Story object in the Presalytics API

    &#34;&#34;&#34;

    story: &#39;Story&#39;
    logger.info(&#34;Starting presalytics tool: create_story_from_ooxml_file&#34;)
    logger.info(&#34;Intializing presalytics client.&#34;)
    
    client = presalytics.Client(**client_info)
    logger.info(&#34;Sending file to presalytics server for document processing and base story creation&#34;)
    story = client.story.story_post_file(file=filename)
    logger.info(&#34;Creating local instances of file widgets&#34;)
    outline = presalytics.StoryOutline.load(story.outline)
    for i in range(0, len(outline.pages)):
        page = outline.pages[i]
        for j in range(0, len(page.widgets)):
            widget = page.widgets[j]
            logger.info(&#39;Creating OoxmlFileWidget with name &#34;{}&#34;&#39;.format(widget.name))
            inst = presalytics.OoxmlFileWidget.deserialize(widget, **client_info)
            presalytics.COMPONENTS.register(inst)
            logger.info(&#39;Rewriting outline with widget: &#34;{}&#34;&#39;.format(widget.name))
            outline.pages[i].widgets[j] = inst.serialize()
    story.outline = outline.dump()
    return story


def create_outline_from_ooxml_document(story_api: &#39;Story&#39;,
                                       ooxml_document: &#39;Document&#39;,
                                       title: str = None,
                                       description: str = None,
                                       themes: typing.Sequence[&#39;ThemeBase&#39;] = None,
                                       client_info={}):
    &#34;&#34;&#34;
    Utility Method for generating a story from a presenation or spreadsheet file

    This method encapsulates a standard workflow for interating the the Presalytics
    API into a single function.  This method takes known `presalytics.client.presalytics_ooxml_automation.models.document.Document`
    with a known `presalytics.client.presalytics_story.models.story.Story`.  This method returns a `presalytics.story.outline.StoryOutline`
    that can be used to replace with existing `presalytics.story.outline.StoryOutline` on the story if the user warrants it.
    

    Parameters
    ----------
    story_api : presalytics.client.presalytics_story.models.story.Story
        The represenation for the Presalytics API instance that will recieve a new associate with the  **ooxml_document**

    ooxml_document : presalytics.client.presalytics_ooxml_automation.models.document.Document 
        the new ooxml_document will be associated with the story.  The outline will be generated from this object

    title : str, optional
        If not provided, the story will take on the title of the `presalytics.client.presalytics_ooxml_automation.models.document.Document` object

    description : str, optional
        If not provided, the story description will initialize as the empty string
    
    themes : list of presalytics.story.components.ThemeBase, optional
        A list of the themes to added to the returned `presalytics.story.outline.StoryOutline`
    
    client_info : dict, optional
        A dictionary containing arguments that will be unpacked and passed to a `presalytics.client.api.Client` object on intialization. 
        This dictionary can include the `token`, `cache_tokens`, `delegate_login` values.  See `presalytics.client.api.Client` for more information.

    Returns
    ----------
    A `presalytics.story.outline.StoryOutline` for the user to optionally serialize and append to the story in downstream operations

    &#34;&#34;&#34;
    info = presalytics.story.outline.Info(
        revision=0,
        date_created=datetime.datetime.utcnow().isoformat(),
        date_modified=datetime.datetime.utcnow().isoformat(),
        created_by=presalytics.CONFIG.get(&#34;USERNAME&#34;, &#34;&#34;),
        modified_by=presalytics.CONFIG.get(&#34;USERNAME&#34;, &#34;&#34;),
        revision_notes=&#39;Created by via &#34;create_outline_from_ooxml_file&#34; method&#39;
    )

    if description:
        _description = description
    else:
        _description = &#34;&#34;
    try:
        pages = create_pages_from_ooxml_document(story_api, ooxml_document, client_info=client_info)
    except Exception as ex:
        logger.error(&#34;Error adding pages to outline&#34;, exc_info=True)
        pages = []
    try:
        if themes:
            _themes = themes
        else:
            ooxml_id = pages[0].widgets[0].data[&#34;document_ooxml_id&#34;]
            _themes = [create_theme_from_ooxml_document(ooxml_id, client_info=client_info)]
    except Exception:
        logger.error(&#34;Unable to add theme to ooxml_story&#34;, exc_info=True)
        _themes = []
    
    if title:
        _title = title
    else:
        _title = pages[0].widgets[0].name

    outline = presalytics.story.outline.StoryOutline(
        info=info,
        pages=pages,
        description=_description,
        title=_title,
        themes=_themes,
        plugins=[]
    )
    return outline


def create_pages_from_ooxml_document(story: &#39;Story&#39;, 
                                     ooxml_document: &#39;Document&#39;,
                                     client_info={}):
    &#34;&#34;&#34;
    Utility Method for building stories into the Presalytics API directly from a Presenation or Spreadsheet file. 

    Parameters
    ----------
    story : presalytics.client.presalytics_story.models.story.Story
        Representation for Presalytics API Story object

    ooxml_document: presalytics.client.presalytics_ooxml_automation.models.document.Document
        The ooxml_document on the story that you want to create pages from

    client_info : dict, optional
        A dictionary containing arguments that will be unpacked and passed to a `presalytics.client.api.Client` object on intialization. 
        This dictionary can include the `token`, `cache_tokens`, `delegate_login` values.  See `presalytics.client.api.Client` for more information.

    Returns:
    ----------
    A list of `presalytics.story.outline.Page` objects representing the slides, pages and charts in the source document

    &#34;&#34;&#34;
    pages = []
    client = presalytics.Client(**client_info)
    child_objects = client.ooxml_automation.documents_childobjects_get_id(ooxml_document.id)
    document_type = client.ooxml_automation.documents_documenttype_typeid_get_type_id(ooxml_document.document_type_id)
    if document_type.file_extension == &#34;pptx&#34;:
        slides_meta = [x for x in child_objects if x.object_type == &#34;Slide.Slides&#34;]
        ep_map = presalytics.OoxmlEndpointMap.slide()
        for slide in slides_meta:
            try:
                widget = presalytics.OoxmlFileWidget(
                    filename=ooxml_document.filename,
                    name=slide.entity_name,
                    endpoint_map=ep_map,
                    object_name=slide.entity_name,
                    object_ooxml_id=slide.entity_id,
                    document_ooxml_id=ooxml_document.id,
                    story_id=story.id,
                    client_info=client_info
                )
                widget_kind = &#34;widget-page&#34;
                widget_name = slide.entity_name
                widgets = [widget.serialize()]
                page = presalytics.story.outline.Page(
                    kind=widget_kind,
                    name=widget_name,
                    widgets=widgets
                )
                pages.append(page)
            except:
                logger.error(&#34;Unable to add widget {0} to outline ooxml document {1}&#34;.format(slide.entity_name, ooxml_document.id))
    # TODO: insert excel chart handling here
    return pages


def create_theme_from_ooxml_document(document_id: str, client_info={}):
    &#34;&#34;&#34;
    Creates a `presalytics.story.outline.Theme` object from an Presalytics API ooxml_document object

    Parameters:
    ----------
    document_id: str
        A string containing a uuid that corresponds to a document in the Ooxml Automation service of the Presalytics API

    client_info : dict, optional
        A dictionary containing arguments that will be unpacked and passed to a `presalytics.client.api.Client` object on intialization. 
        This dictionary can include the `token`, `cache_tokens`, `delegate_login` values.  See `presalytics.client.api.Client` for more information.

    Returns:
    ----------
    A `presalytics.story.outline.Theme` object with formats extracted from the ooxml_document

    &#34;&#34;&#34;
    client = presalytics.Client(**client_info)
    child_objects = client.ooxml_automation.documents_childobjects_get_id(document_id)
    themes = [x for x in child_objects if x.object_type == &#34;Theme.Themes&#34;]
    if len(themes) &gt; 1:
        slide_no = None
        for theme_data in themes:
            theme_info = client.ooxml_automation.theme_themes_get_id(theme_data.entity_id)
            parent_slide = client.ooxml_automation.slides_slides_get_id(theme_info.slide_id)
            if slide_no is None:
                slide_no = parent_slide.number
                theme_meta = theme_info
            else:
                if parent_slide.number &lt; slide_no:
                    theme_meta = theme_info
                    if parent_slide.number == 0:
                        break
    else:
        theme_meta = client.ooxml_automation.theme_themes_get_id(themes[0].entity_id)
    theme = presalytics.lib.themes.ooxml.OoxmlTheme(
        theme_meta.name, 
        theme_meta.id, 
        client_info=client_info
    )
    return theme.serialize().to_dict()

def get_mime_type_from_filename(client: presalytics.Client, filename) -&gt; typing.Optional[str]:
    &#34;&#34;&#34;
    Determines the mimetype from a file&#39;s type extension

    Parameters:
    ----------
    client : presalytics.client.api.Client
        A client object for making api calls
    
    filename : str
        A filename against which the method can lookup mimetypes

    Returns:
    ----------
    A string containing a mimetype to attach to file uploads

    &#34;&#34;&#34;
    doc_types = client.ooxml_automation.documents_documenttype_get()
    file_extension = filename.split(&#34;.&#34;)[-1]
    try:
        return next(x.mime_type for x in doc_types if x.file_extension == file_extension)
    except StopIteration:
        return None
        </code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="presalytics.lib.tools.ooxml_tools.add_ooxml_document_to_story"><code class="name flex">
<span>def <span class="ident">add_ooxml_document_to_story</span></span>(<span>story_id, new_document_filepath, replace_id=None, username=None, password=None)</span>
</code></dt>
<dd>
<section class="desc"><p>Utility method for asscoiating a new Document in the Presalytics API Ooxml Automation service
with a Story.
</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>story_id</code></strong> :&ensp;<code>str</code></dt>
<dd>The Presalytics API Story service Id for for the story</dd>
</dl>
<p>new_document_filepath str
The local filepath to the document tha you want to associate with the story</p>
<dl>
<dt><strong><code>replace_id</code></strong> :&ensp;<code>str</code>, <code>option</code></dt>
<dd>
<p>If you want to replace a document, this the documents Ooxml Automation service Id
</p>
<p>Passing this value will also update the references to Ooxml Automation
service Document object in the Story Outline.
This is a good option if you have
not made significant changes to the new version of the document.
Widgets may
fail to render if more than minor changes are made to the object tree.</p>
</dd>
<dt><strong><code>username</code></strong> :&ensp;<code>str</code>, <code>option</code></dt>
<dd>Presalytics API username.
Defaults to workspace username.</dd>
<dt><strong><code>password</code></strong> :&ensp;<code>str</code>, <code>option</code></dt>
<dd>Presalytics API password.</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/tools/ooxml_tools.py#L20-L53" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def add_ooxml_document_to_story(story_id, new_document_filepath, replace_id=None, username=None, password=None):
    &#34;&#34;&#34;
    Utility method for asscoiating a new Document in the Presalytics API Ooxml Automation service
    with a Story.  

    Parameters
    ----------
    story_id: str
        The Presalytics API Story service Id for for the story

    new_document_filepath str
        The local filepath to the document tha you want to associate with the story

    replace_id: str, option
        If you want to replace a document, this the documents Ooxml Automation service Id  
        
        Passing this value will also update the references to Ooxml Automation
        service Document object in the Story Outline.  This is a good option if you have
        not made significant changes to the new version of the document.  Widgets may 
        fail to render if more than minor changes are made to the object tree.

    username: str, option
        Presalytics API username.  Defaults to workspace username.

    password: str, option
        Presalytics API password. 
    &#34;&#34;&#34;

    client = presalytics.client.api.Client(username=username, password=password)
    if story_id == &#34;empty&#34; or not story_id:
        message = &#34;The story_id must not be empty&#34;
        raise presalytics.lib.exceptions.InvalidArgumentException(message)
    replace = True if replace_id else False
    story = client.story.story_id_file_post(story_id, file=new_document_filepath, replace_existing=replace, obsolete_id=replace_id)</code></pre>
</details>
</dd>
<dt id="presalytics.lib.tools.ooxml_tools.create_story_from_ooxml_file"><code class="name flex">
<span>def <span class="ident">create_story_from_ooxml_file</span></span>(<span>filename, client_info={})</span>
</code></dt>
<dd>
<section class="desc"><p>Utility Method for building stories into the Presalytics API directly from a Presentation or Spreadsheet file. </p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>filename</code></strong> :&ensp;<code>str</code></dt>
<dd>A string contain the local path to a presenation or spreadsheet object.</dd>
<dt><strong><code>client_info</code></strong> :&ensp;<code>dict</code>, optional</dt>
<dd>A dictionary containing arguments that will be unpacked and passed to a <a title="presalytics.client.api.Client" href="/python-client/presalytics/client/api.html#presalytics.client.api.Client"><code>Client</code></a> object on intialization.
This dictionary can include the <code>token</code>, <code>cache_tokens</code>, <code>delegate_login</code> values.
See <a title="presalytics.client.api.Client" href="/python-client/presalytics/client/api.html#presalytics.client.api.Client"><code>Client</code></a> for more information.</dd>
</dl>
<h2 id="returns">Returns:</h2>
<p>A <a title="presalytics.client.presalytics_story.models.story.Story" href="/python-client/presalytics/client/presalytics_story/models/story.html#presalytics.client.presalytics_story.models.story.Story"><code>Story</code></a> containing information about the Story object in the Presalytics API</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/tools/ooxml_tools.py#L55-L93" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def create_story_from_ooxml_file(filename: str, client_info={}) -&gt; &#39;Story&#39;:
    &#34;&#34;&#34;
    Utility Method for building stories into the Presalytics API directly from a Presentation or Spreadsheet file. 

    Parameters
    ----------
    filename : str
        A string contain the local path to a presenation or spreadsheet object.

    client_info : dict, optional
        A dictionary containing arguments that will be unpacked and passed to a `presalytics.client.api.Client` object on intialization. 
        This dictionary can include the `token`, `cache_tokens`, `delegate_login` values.  See `presalytics.client.api.Client` for more information.

    Returns:
    ----------
    A `presalytics.client.presalytics_story.models.story.Story` containing information about the Story object in the Presalytics API

    &#34;&#34;&#34;

    story: &#39;Story&#39;
    logger.info(&#34;Starting presalytics tool: create_story_from_ooxml_file&#34;)
    logger.info(&#34;Intializing presalytics client.&#34;)
    
    client = presalytics.Client(**client_info)
    logger.info(&#34;Sending file to presalytics server for document processing and base story creation&#34;)
    story = client.story.story_post_file(file=filename)
    logger.info(&#34;Creating local instances of file widgets&#34;)
    outline = presalytics.StoryOutline.load(story.outline)
    for i in range(0, len(outline.pages)):
        page = outline.pages[i]
        for j in range(0, len(page.widgets)):
            widget = page.widgets[j]
            logger.info(&#39;Creating OoxmlFileWidget with name &#34;{}&#34;&#39;.format(widget.name))
            inst = presalytics.OoxmlFileWidget.deserialize(widget, **client_info)
            presalytics.COMPONENTS.register(inst)
            logger.info(&#39;Rewriting outline with widget: &#34;{}&#34;&#39;.format(widget.name))
            outline.pages[i].widgets[j] = inst.serialize()
    story.outline = outline.dump()
    return story</code></pre>
</details>
</dd>
<dt id="presalytics.lib.tools.ooxml_tools.create_outline_from_ooxml_document"><code class="name flex">
<span>def <span class="ident">create_outline_from_ooxml_document</span></span>(<span>story_api, ooxml_document, title=None, description=None, themes=None, client_info={})</span>
</code></dt>
<dd>
<section class="desc"><p>Utility Method for generating a story from a presenation or spreadsheet file</p>
<p>This method encapsulates a standard workflow for interating the the Presalytics
API into a single function.
This method takes known <a title="presalytics.client.presalytics_ooxml_automation.models.document.Document" href="/python-client/presalytics/client/presalytics_ooxml_automation/models/document.html#presalytics.client.presalytics_ooxml_automation.models.document.Document"><code>Document</code></a>
with a known <a title="presalytics.client.presalytics_story.models.story.Story" href="/python-client/presalytics/client/presalytics_story/models/story.html#presalytics.client.presalytics_story.models.story.Story"><code>Story</code></a>.
This method returns a <a title="presalytics.story.outline.StoryOutline" href="/python-client/presalytics/story/outline.html#presalytics.story.outline.StoryOutline"><code>StoryOutline</code></a>
that can be used to replace with existing <a title="presalytics.story.outline.StoryOutline" href="/python-client/presalytics/story/outline.html#presalytics.story.outline.StoryOutline"><code>StoryOutline</code></a> on the story if the user warrants it.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>story_api</code></strong> :&ensp;<a title="presalytics.client.presalytics_story.models.story.Story" href="/python-client/presalytics/client/presalytics_story/models/story.html#presalytics.client.presalytics_story.models.story.Story"><code>Story</code></a></dt>
<dd>The represenation for the Presalytics API instance that will recieve a new associate with the
<strong>ooxml_document</strong></dd>
<dt><strong><code>ooxml_document</code></strong> :&ensp;<a title="presalytics.client.presalytics_ooxml_automation.models.document.Document" href="/python-client/presalytics/client/presalytics_ooxml_automation/models/document.html#presalytics.client.presalytics_ooxml_automation.models.document.Document"><code>Document</code></a></dt>
<dd>the new ooxml_document will be associated with the story.
The outline will be generated from this object</dd>
<dt><strong><code>title</code></strong> :&ensp;<code>str</code>, optional</dt>
<dd>If not provided, the story will take on the title of the <a title="presalytics.client.presalytics_ooxml_automation.models.document.Document" href="/python-client/presalytics/client/presalytics_ooxml_automation/models/document.html#presalytics.client.presalytics_ooxml_automation.models.document.Document"><code>Document</code></a> object</dd>
<dt><strong><code>description</code></strong> :&ensp;<code>str</code>, optional</dt>
<dd>If not provided, the story description will initialize as the empty string</dd>
<dt><strong><code>themes</code></strong> :&ensp;<code>list</code> of <a title="presalytics.story.components.ThemeBase" href="/python-client/presalytics/story/components.html#presalytics.story.components.ThemeBase"><code>ThemeBase</code></a>, optional</dt>
<dd>A list of the themes to added to the returned <a title="presalytics.story.outline.StoryOutline" href="/python-client/presalytics/story/outline.html#presalytics.story.outline.StoryOutline"><code>StoryOutline</code></a></dd>
<dt><strong><code>client_info</code></strong> :&ensp;<code>dict</code>, optional</dt>
<dd>A dictionary containing arguments that will be unpacked and passed to a <a title="presalytics.client.api.Client" href="/python-client/presalytics/client/api.html#presalytics.client.api.Client"><code>Client</code></a> object on intialization.
This dictionary can include the <code>token</code>, <code>cache_tokens</code>, <code>delegate_login</code> values.
See <a title="presalytics.client.api.Client" href="/python-client/presalytics/client/api.html#presalytics.client.api.Client"><code>Client</code></a> for more information.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>A <a title="presalytics.story.outline.StoryOutline" href="/python-client/presalytics/story/outline.html#presalytics.story.outline.StoryOutline"><code>StoryOutline</code></a> for the user to optionally serialize and append to the story in downstream operations</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/tools/ooxml_tools.py#L96-L178" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def create_outline_from_ooxml_document(story_api: &#39;Story&#39;,
                                       ooxml_document: &#39;Document&#39;,
                                       title: str = None,
                                       description: str = None,
                                       themes: typing.Sequence[&#39;ThemeBase&#39;] = None,
                                       client_info={}):
    &#34;&#34;&#34;
    Utility Method for generating a story from a presenation or spreadsheet file

    This method encapsulates a standard workflow for interating the the Presalytics
    API into a single function.  This method takes known `presalytics.client.presalytics_ooxml_automation.models.document.Document`
    with a known `presalytics.client.presalytics_story.models.story.Story`.  This method returns a `presalytics.story.outline.StoryOutline`
    that can be used to replace with existing `presalytics.story.outline.StoryOutline` on the story if the user warrants it.
    

    Parameters
    ----------
    story_api : presalytics.client.presalytics_story.models.story.Story
        The represenation for the Presalytics API instance that will recieve a new associate with the  **ooxml_document**

    ooxml_document : presalytics.client.presalytics_ooxml_automation.models.document.Document 
        the new ooxml_document will be associated with the story.  The outline will be generated from this object

    title : str, optional
        If not provided, the story will take on the title of the `presalytics.client.presalytics_ooxml_automation.models.document.Document` object

    description : str, optional
        If not provided, the story description will initialize as the empty string
    
    themes : list of presalytics.story.components.ThemeBase, optional
        A list of the themes to added to the returned `presalytics.story.outline.StoryOutline`
    
    client_info : dict, optional
        A dictionary containing arguments that will be unpacked and passed to a `presalytics.client.api.Client` object on intialization. 
        This dictionary can include the `token`, `cache_tokens`, `delegate_login` values.  See `presalytics.client.api.Client` for more information.

    Returns
    ----------
    A `presalytics.story.outline.StoryOutline` for the user to optionally serialize and append to the story in downstream operations

    &#34;&#34;&#34;
    info = presalytics.story.outline.Info(
        revision=0,
        date_created=datetime.datetime.utcnow().isoformat(),
        date_modified=datetime.datetime.utcnow().isoformat(),
        created_by=presalytics.CONFIG.get(&#34;USERNAME&#34;, &#34;&#34;),
        modified_by=presalytics.CONFIG.get(&#34;USERNAME&#34;, &#34;&#34;),
        revision_notes=&#39;Created by via &#34;create_outline_from_ooxml_file&#34; method&#39;
    )

    if description:
        _description = description
    else:
        _description = &#34;&#34;
    try:
        pages = create_pages_from_ooxml_document(story_api, ooxml_document, client_info=client_info)
    except Exception as ex:
        logger.error(&#34;Error adding pages to outline&#34;, exc_info=True)
        pages = []
    try:
        if themes:
            _themes = themes
        else:
            ooxml_id = pages[0].widgets[0].data[&#34;document_ooxml_id&#34;]
            _themes = [create_theme_from_ooxml_document(ooxml_id, client_info=client_info)]
    except Exception:
        logger.error(&#34;Unable to add theme to ooxml_story&#34;, exc_info=True)
        _themes = []
    
    if title:
        _title = title
    else:
        _title = pages[0].widgets[0].name

    outline = presalytics.story.outline.StoryOutline(
        info=info,
        pages=pages,
        description=_description,
        title=_title,
        themes=_themes,
        plugins=[]
    )
    return outline</code></pre>
</details>
</dd>
<dt id="presalytics.lib.tools.ooxml_tools.create_pages_from_ooxml_document"><code class="name flex">
<span>def <span class="ident">create_pages_from_ooxml_document</span></span>(<span>story, ooxml_document, client_info={})</span>
</code></dt>
<dd>
<section class="desc"><p>Utility Method for building stories into the Presalytics API directly from a Presenation or Spreadsheet file. </p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>story</code></strong> :&ensp;<a title="presalytics.client.presalytics_story.models.story.Story" href="/python-client/presalytics/client/presalytics_story/models/story.html#presalytics.client.presalytics_story.models.story.Story"><code>Story</code></a></dt>
<dd>Representation for Presalytics API Story object</dd>
<dt><strong><code>ooxml_document</code></strong> :&ensp;<a title="presalytics.client.presalytics_ooxml_automation.models.document.Document" href="/python-client/presalytics/client/presalytics_ooxml_automation/models/document.html#presalytics.client.presalytics_ooxml_automation.models.document.Document"><code>Document</code></a></dt>
<dd>The ooxml_document on the story that you want to create pages from</dd>
<dt><strong><code>client_info</code></strong> :&ensp;<code>dict</code>, optional</dt>
<dd>A dictionary containing arguments that will be unpacked and passed to a <a title="presalytics.client.api.Client" href="/python-client/presalytics/client/api.html#presalytics.client.api.Client"><code>Client</code></a> object on intialization.
This dictionary can include the <code>token</code>, <code>cache_tokens</code>, <code>delegate_login</code> values.
See <a title="presalytics.client.api.Client" href="/python-client/presalytics/client/api.html#presalytics.client.api.Client"><code>Client</code></a> for more information.</dd>
</dl>
<h2 id="returns">Returns:</h2>
<p>A list of <a title="presalytics.story.outline.Page" href="/python-client/presalytics/story/outline.html#presalytics.story.outline.Page"><code>Page</code></a> objects representing the slides, pages and charts in the source document</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/tools/ooxml_tools.py#L181-L235" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def create_pages_from_ooxml_document(story: &#39;Story&#39;, 
                                     ooxml_document: &#39;Document&#39;,
                                     client_info={}):
    &#34;&#34;&#34;
    Utility Method for building stories into the Presalytics API directly from a Presenation or Spreadsheet file. 

    Parameters
    ----------
    story : presalytics.client.presalytics_story.models.story.Story
        Representation for Presalytics API Story object

    ooxml_document: presalytics.client.presalytics_ooxml_automation.models.document.Document
        The ooxml_document on the story that you want to create pages from

    client_info : dict, optional
        A dictionary containing arguments that will be unpacked and passed to a `presalytics.client.api.Client` object on intialization. 
        This dictionary can include the `token`, `cache_tokens`, `delegate_login` values.  See `presalytics.client.api.Client` for more information.

    Returns:
    ----------
    A list of `presalytics.story.outline.Page` objects representing the slides, pages and charts in the source document

    &#34;&#34;&#34;
    pages = []
    client = presalytics.Client(**client_info)
    child_objects = client.ooxml_automation.documents_childobjects_get_id(ooxml_document.id)
    document_type = client.ooxml_automation.documents_documenttype_typeid_get_type_id(ooxml_document.document_type_id)
    if document_type.file_extension == &#34;pptx&#34;:
        slides_meta = [x for x in child_objects if x.object_type == &#34;Slide.Slides&#34;]
        ep_map = presalytics.OoxmlEndpointMap.slide()
        for slide in slides_meta:
            try:
                widget = presalytics.OoxmlFileWidget(
                    filename=ooxml_document.filename,
                    name=slide.entity_name,
                    endpoint_map=ep_map,
                    object_name=slide.entity_name,
                    object_ooxml_id=slide.entity_id,
                    document_ooxml_id=ooxml_document.id,
                    story_id=story.id,
                    client_info=client_info
                )
                widget_kind = &#34;widget-page&#34;
                widget_name = slide.entity_name
                widgets = [widget.serialize()]
                page = presalytics.story.outline.Page(
                    kind=widget_kind,
                    name=widget_name,
                    widgets=widgets
                )
                pages.append(page)
            except:
                logger.error(&#34;Unable to add widget {0} to outline ooxml document {1}&#34;.format(slide.entity_name, ooxml_document.id))
    # TODO: insert excel chart handling here
    return pages</code></pre>
</details>
</dd>
<dt id="presalytics.lib.tools.ooxml_tools.create_theme_from_ooxml_document"><code class="name flex">
<span>def <span class="ident">create_theme_from_ooxml_document</span></span>(<span>document_id, client_info={})</span>
</code></dt>
<dd>
<section class="desc"><p>Creates a <a title="presalytics.story.outline.Theme" href="/python-client/presalytics/story/outline.html#presalytics.story.outline.Theme"><code>Theme</code></a> object from an Presalytics API ooxml_document object</p>
<h2 id="parameters">Parameters:</h2>
<p>document_id: str
A string containing a uuid that corresponds to a document in the Ooxml Automation service of the Presalytics API</p>
<p>client_info : dict, optional
A dictionary containing arguments that will be unpacked and passed to a <a title="presalytics.client.api.Client" href="/python-client/presalytics/client/api.html#presalytics.client.api.Client"><code>Client</code></a> object on intialization.
This dictionary can include the <code>token</code>, <code>cache_tokens</code>, <code>delegate_login</code> values.
See <a title="presalytics.client.api.Client" href="/python-client/presalytics/client/api.html#presalytics.client.api.Client"><code>Client</code></a> for more information.</p>
<h2 id="returns">Returns:</h2>
<p>A <a title="presalytics.story.outline.Theme" href="/python-client/presalytics/story/outline.html#presalytics.story.outline.Theme"><code>Theme</code></a> object with formats extracted from the ooxml_document</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/tools/ooxml_tools.py#L238-L279" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def create_theme_from_ooxml_document(document_id: str, client_info={}):
    &#34;&#34;&#34;
    Creates a `presalytics.story.outline.Theme` object from an Presalytics API ooxml_document object

    Parameters:
    ----------
    document_id: str
        A string containing a uuid that corresponds to a document in the Ooxml Automation service of the Presalytics API

    client_info : dict, optional
        A dictionary containing arguments that will be unpacked and passed to a `presalytics.client.api.Client` object on intialization. 
        This dictionary can include the `token`, `cache_tokens`, `delegate_login` values.  See `presalytics.client.api.Client` for more information.

    Returns:
    ----------
    A `presalytics.story.outline.Theme` object with formats extracted from the ooxml_document

    &#34;&#34;&#34;
    client = presalytics.Client(**client_info)
    child_objects = client.ooxml_automation.documents_childobjects_get_id(document_id)
    themes = [x for x in child_objects if x.object_type == &#34;Theme.Themes&#34;]
    if len(themes) &gt; 1:
        slide_no = None
        for theme_data in themes:
            theme_info = client.ooxml_automation.theme_themes_get_id(theme_data.entity_id)
            parent_slide = client.ooxml_automation.slides_slides_get_id(theme_info.slide_id)
            if slide_no is None:
                slide_no = parent_slide.number
                theme_meta = theme_info
            else:
                if parent_slide.number &lt; slide_no:
                    theme_meta = theme_info
                    if parent_slide.number == 0:
                        break
    else:
        theme_meta = client.ooxml_automation.theme_themes_get_id(themes[0].entity_id)
    theme = presalytics.lib.themes.ooxml.OoxmlTheme(
        theme_meta.name, 
        theme_meta.id, 
        client_info=client_info
    )
    return theme.serialize().to_dict()</code></pre>
</details>
</dd>
<dt id="presalytics.lib.tools.ooxml_tools.get_mime_type_from_filename"><code class="name flex">
<span>def <span class="ident">get_mime_type_from_filename</span></span>(<span>client, filename)</span>
</code></dt>
<dd>
<section class="desc"><p>Determines the mimetype from a file's type extension</p>
<h2 id="parameters">Parameters:</h2>
<p>client : presalytics.client.api.Client
A client object for making api calls</p>
<p>filename : str
A filename against which the method can lookup mimetypes</p>
<h2 id="returns">Returns:</h2>
<p>A string containing a mimetype to attach to file uploads</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/tools/ooxml_tools.py#L281-L303" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def get_mime_type_from_filename(client: presalytics.Client, filename) -&gt; typing.Optional[str]:
    &#34;&#34;&#34;
    Determines the mimetype from a file&#39;s type extension

    Parameters:
    ----------
    client : presalytics.client.api.Client
        A client object for making api calls
    
    filename : str
        A filename against which the method can lookup mimetypes

    Returns:
    ----------
    A string containing a mimetype to attach to file uploads

    &#34;&#34;&#34;
    doc_types = client.ooxml_automation.documents_documenttype_get()
    file_extension = filename.split(&#34;.&#34;)[-1]
    try:
        return next(x.mime_type for x in doc_types if x.file_extension == file_extension)
    except StopIteration:
        return None</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="presalytics.lib.tools" href="/python-client/presalytics/lib/tools/index.html">presalytics.lib.tools</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="presalytics.lib.tools.ooxml_tools.add_ooxml_document_to_story" href="/python-client/presalytics/lib/tools/ooxml_tools.html#presalytics.lib.tools.ooxml_tools.add_ooxml_document_to_story">add_ooxml_document_to_story</a></code></li>
<li><code><a title="presalytics.lib.tools.ooxml_tools.create_story_from_ooxml_file" href="/python-client/presalytics/lib/tools/ooxml_tools.html#presalytics.lib.tools.ooxml_tools.create_story_from_ooxml_file">create_story_from_ooxml_file</a></code></li>
<li><code><a title="presalytics.lib.tools.ooxml_tools.create_outline_from_ooxml_document" href="/python-client/presalytics/lib/tools/ooxml_tools.html#presalytics.lib.tools.ooxml_tools.create_outline_from_ooxml_document">create_outline_from_ooxml_document</a></code></li>
<li><code><a title="presalytics.lib.tools.ooxml_tools.create_pages_from_ooxml_document" href="/python-client/presalytics/lib/tools/ooxml_tools.html#presalytics.lib.tools.ooxml_tools.create_pages_from_ooxml_document">create_pages_from_ooxml_document</a></code></li>
<li><code><a title="presalytics.lib.tools.ooxml_tools.create_theme_from_ooxml_document" href="/python-client/presalytics/lib/tools/ooxml_tools.html#presalytics.lib.tools.ooxml_tools.create_theme_from_ooxml_document">create_theme_from_ooxml_document</a></code></li>
<li><code><a title="presalytics.lib.tools.ooxml_tools.get_mime_type_from_filename" href="/python-client/presalytics/lib/tools/ooxml_tools.html#presalytics.lib.tools.ooxml_tools.get_mime_type_from_filename">get_mime_type_from_filename</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.7.4</a>.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>