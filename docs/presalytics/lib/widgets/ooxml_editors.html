<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.2" />
<title>presalytics.lib.widgets.ooxml_editors API documentation</title>
<meta name="description" content="" />
<link href='https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css' rel='stylesheet'>
<link href='https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/8.0.0/sanitize.min.css' rel='stylesheet'>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{font-weight:bold}#index h4 + ul{margin-bottom:.6em}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>presalytics.lib.widgets.ooxml_editors</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/widgets/ooxml_editors.py#L0-L518" class="git-link">Browse git</a>
</summary>
<pre><code class="python">import typing
import types
import logging
import json
import lxml
import lxml.etree
import abc
import re
import requests
import presalytics
import presalytics.lib.registry
import presalytics.lib.exceptions
import presalytics.lib.widgets.ooxml


logger = logging.getLogger(__name__)


class XmlTransformBase(abc.ABC):
    &#34;&#34;&#34;
    Base class for writing Open Office Xml tranform functions to be implemented
    by `presalytics.lib.widgets.ooxml_editors.OoxmlEditorWidget`

    *For more information about Open Office Xml Schema that underlies
    .pptx and .xlsx files, see http://officeopenxml.com/

    *For more information on how to lxml to write transforms, consult https://lxml.de/

    Parameters
    ----------
    function_params : dict
        A dictionary containing variables that will be used when the `transform_function`
        is executed
    &#34;&#34;&#34;
    __xml_transform_kind__ = &#39;XmlTransform&#39;

    def __init__(self, function_params: typing.Dict, *args, **kwargs):
        self.function_params = function_params

    @abc.abstractmethod
    def transform_function(self, lxml_element: lxml.etree.Element, params: typing.Dict) -&gt; lxml.etree.Element:
        &#34;&#34;&#34;
        Modifies Open Office Xml via transforming `lxml.etree.Element` using a params `dict` containing
        variables. Must be overridden in subclasses.
        &#34;&#34;&#34;
        pass

    def execute(self, lxml_element: lxml.etree.Element):
        &#34;&#34;&#34;
        Called by widget classes (e.g., `presalytics.lib.widgets.ooxml_editors.OoxmlEditorWidget`) to
        perform the updates prescribed in the `transform_function`
        &#34;&#34;&#34;
        return self.transform_function(lxml_element, self.function_params)


class ChangeShapeColor(XmlTransformBase):
    &#34;&#34;&#34;
    Changes the color of a set of [Open Office Xml Shapes](http://officeopenxml.com/drwShape.php)

    Function Parameters Dictionary
    ----------
    hex_color : str
        The six-digit hexadecimal-format color string (e.g., ffa500 for orange).  See
        https://www.color-hex.com/ for an example color calculator

    object_name : str, optional
        The object tree name of the target shape.  If not supplied, all descendent shapes will
        have their color changed.
    &#34;&#34;&#34;
    __xml_transform_name__ = &#34;ChangeShapeColor&#34;

    @staticmethod
    def replace_color_on_target_shape(shape_xml: lxml.etree.Element, new_color: str) -&gt; lxml.etree.Element:
        &#34;&#34;&#34;
        Changes the color of an [Open Office Xml Shape](http://officeopenxml.com/drwShape.php)
        &#34;&#34;&#34;
        new_fill = lxml.etree.Element(&#34;solidFill&#34;)
        lxml.etree.SubElement(new_fill, &#34;srbgClr&#34;, {&#34;val&#34;: new_color})
        fill_tags = [
            &#39;noFill&#39;,
            &#39;blipFill&#39;,
            &#39;gradFill&#39;,
            &#39;pattFill&#39;,
            &#39;solidFill&#39;
        ]
        props = shape_xml.find(&#39;.//{*}spPr&#39;)
        for child in props.getchildren():
            if any(re.search(&#39;{*}&#39; + r, child.tag) for r in fill_tags):
                current_nsmap = child.nsmap
                current_index = props.index(child)
                current_prefix = child.prefix
                current_ns = current_nsmap.get(current_prefix, None)
                new_fill = lxml.etree.Element(lxml.etree.QName(current_ns, &#34;solidFill&#34;), nsmap=current_nsmap)
                lxml.etree.SubElement(new_fill, lxml.etree.QName(current_ns, &#34;srgbClr&#34;), {&#34;val&#34;: new_color}, nsmap=current_nsmap)
                child.getparent().remove(child)
                props.insert(current_index, new_fill)
        return shape_xml

    def transform_function(self, lxml_element, params):
        &#34;&#34;&#34;
        Changes the color of an [Open Office Xml Shape](http://officeopenxml.com/drwShape.php)

        Parameters
        -----------
        lxml_element : lxml.etree.Element
            An element containing as least one an `&lt;sp&gt;` element

        params : dict
            See the `Function Parameters Dictionary` for required entries
        &#34;&#34;&#34;

        if re.match(&#39;{.*}sp&#39;, lxml_element.tag):
            shapes = [lxml_element]
        else:
            shapes = lxml_element.findall(&#39;.//{*}sp&#39;)
        object_name = params.get(&#34;object_name&#34;, None)
        color = params.get(&#34;hex_color&#34;).lstrip(&#34;#&#34;).upper()
        if object_name:
            for shape in shapes:
                is_target = False
                nvprops = shape.find(&#39;.//{*}nvSpPr&#39;)
                if len(nvprops) &gt; 0:
                    name = nvprops.find(&#39;.//*[@name]&#39;).get(&#34;name&#34;)
                    if name == object_name:
                        is_target = True
                if is_target:
                    shape = ChangeShapeColor.replace_color_on_target_shape(shape, color)
        else:
            for shape in shapes:
                shape = ChangeShapeColor.replace_color_on_target_shape(shape, color)
        return lxml_element


class TextReplace(XmlTransformBase):
    &#34;&#34;&#34;
    Replaces text in a template built into an Office Office Xml object that has
    been uploaded to the Presalytics Ooxml Automation service.  Text to be should
    be in the format of a &#34;template tag&#34;, which is a string enclosed in handlebars
    as such: &#39;{{template_tag}}&#39;

    Function Parameters Dictionary
    ----------

    replace_map: dict
        A dictionary that maps template tags to the new strings that will replace the
        tags in the rendered widget.  The the dictionary keys should not be enclosed in handlebars.

    object_name: str, optional
        The name of a sub object will be the target of this function.  If not includes, this will
        default to the parent object.  Allows different replace map to be applied to multiple elements in
        a widget

    &#34;&#34;&#34;
    __xml_transform_name__ = &#34;TextReplace&#34;

    class TextElementInfo(object):
        &#34;&#34;&#34;
        Holds metadata for a list of `&lt;t&gt;` tags from an Office Open Xml document.
        &#34;&#34;&#34;

        def __init__(self, element: lxml.etree.Element, start_position: int):
            self.element = element
            self.text = &#34;&#34; if not element.text else element.text
            self.length = len(self.text)
            self.start_position = start_position
            self.end_position = self.start_position + self.length - 1

    class TextList(object):
        &#34;&#34;&#34;
        Class for managing a list of `TextElementInfo` objects
        &#34;&#34;&#34;
        _list: typing.List[&#39;TextReplace.TextElementInfo&#39;]

        def __init__(self):
            self._list = []

        def append(self, text_element_info):
            if isinstance(text_element_info, globals()[&#39;TextReplace&#39;].TextElementInfo):
                self._list.append(text_element_info)
            else:
                raise presalytics.lib.exceptions.InvalidArgumentException(message=&#34;Argument must be an instance of class &#39;TextElementInfo&#39;&#34;)

        def set_text(self, index, new_string):
            self._list[index].text = new_string
            self._list[index].element.text = new_string

        def get_text(self, index):
            return self._list[index].text

        def get_plaintext_string(self):
            ret = &#34;&#34;
            for item in self._list:
                ret += item.text
            return ret

        def get_position(self, match_strings):
            for potential_match in match_strings:
                i = self.get_plaintext_string().find(potential_match)
                if i &gt;= 0:
                    break
            return i, potential_match

        def get_list_index_of_position(self, position: int):
            for item in self._list:
                if item.start_position &lt;= position and item.end_position &gt;= position:
                    return self.get_index(item)
            raise presalytics.lib.exceptions.InvalidArgumentException(message=&#34;Position {} out of range&#34;.format(position))

        def get_index(self, text_element_info: &#39;TextReplace.TextElementInfo&#39;):
            for i in range(len(self._list)):
                if self._list[i] == text_element_info:
                    return i
            raise presalytics.lib.exceptions.InvalidArgumentException(message=&#34;Supplied argument on in self._list&#34;)

        def set_text_to_empty_string(self, index):
            self._list[index].text = &#34;&#34;
            self._list[index].element.text = &#34;&#34;

        def set_start_to_new_value(self, index, new_value):
            start_text, remainder = self._list[index].text.split(&#34;{{&#34;, 1)
            end = &#34;&#34;
            if &#34;}}&#34; in remainder:
                end = remainder.split(&#34;}}&#34;, 1)[1]
            new_text = &#34;{0}{1}{2}&#34;.format(start_text, new_value, end)
            self._list[index].text = new_text
            self._list[index].element.text = new_text

        def truncate_end(self, index):
            end_text = self._list[index].text.split(&#34;}}&#34;, 1)[-1]
            self._list[index].text = end_text
            self._list[index].element.text = end_text

        def plaintext_string_list(self):
            return [x.text for x in self._list]

        def reset(self):
            for i in range(0, len(self._list)):
                start_position = 0 if i == 0 else self._list[i - 1].end_position + 1
                self._list[i] = TextReplace.TextElementInfo(self._list[i].element, start_position)

    def replace_handlebars(self, info_list, params):
        &#34;&#34;&#34;
        Method that finds template tags and replaces them

        TODO: Upgrade to Liquid Syntax (or similar)
        &#34;&#34;&#34;
        for key, val in params.items():
            match_keys = [&#34;{{&#34; + key + &#34;}}&#34;, &#34;{{ &#34; + key + &#34; }}&#34;]
            match_start_position, match_key = info_list.get_position(match_keys)
            if match_start_position &gt; -1:
                match_end_position = match_start_position + len(match_key) - 1
                match_start_index = info_list.get_list_index_of_position(match_start_position)
                match_end_index = info_list.get_list_index_of_position(match_end_position)
                if match_start_index &lt; match_end_index:
                    info_list.truncate_end(match_end_index)
                for i in range(match_start_index + 1, match_end_index):
                    info_list.set_text_to_empty_string(i)
                info_list.set_start_to_new_value(match_start_index, val)
                info_list.reset()
                self.replace_handlebars(info_list, params)

    def transform_function(self, lxml_element, params):
        &#34;&#34;&#34;
        Replaces template tags located {{inside_handlebars}} that match keys in the
        `params` dict with values from the `params` dict.

        This method searches for match for plain text strings, so that if template
        tags are split across xml `&lt;t&gt;` elements, they are still identified and replaced.

        Parameters
        -----------
        lxml_element : lxml.etree.Element
            An element containing as least one an `&lt;t&gt;` element

        params : dict
            A dictionary that maps template tags (no handlebars) to their respective
            replacement values.
        &#34;&#34;&#34;
        target_object = lxml_element
        target_object_name = params.get(&#34;object_name&#34;, None)
        if target_object_name:
            nvProps = lxml_element.findall(&#39;.//{*}cNvPr&#39;)
            for ele in nvProps:
                if ele.get(&#34;name&#34;, None) == target_object_name:
                    target_object = ele.getparent().getparent()
                    break

        text_list = target_object.findall(&#39;.//{*}t&#39;)
        info_list = TextReplace.TextList()
        position = 0
        for tag in text_list:
            info = self.TextElementInfo(tag, position)
            position = info.end_position + 1
            info_list.append(info)
        self.replace_handlebars(info_list, params.get(&#34;replace_map&#34;))
        return lxml_element


class XmlTransformRegistry(presalytics.lib.registry.RegistryBase):
    &#34;&#34;&#34;
    Registry for XmlTransform Classes.  Read by `presalytics.lib.widgets.ooxml_editors.MultiXmlTransform`
    and `presalytics.lib.widgets.ooxml_editors.OoxmlEditorWidget` so XmlTransformBase subclasses
    can be deserialized at run-time without a loaded instance in `locals()`.
    &#34;&#34;&#34;

    def __init__(self):
        include_paths = presalytics.COMPONENTS.autodiscover_paths  # todo: Change this line -does not exist at timport time.
        reserved_names = presalytics.COMPONENTS.reserved_names
        super(XmlTransformRegistry, self).__init__(autodiscover_paths=include_paths, reserved_names=reserved_names)

    def get_name(self, klass):
        return getattr(klass, &#34;__xml_transform_name__&#34;, None)

    def get_type(self, klass):
        return getattr(klass, &#34;__xml_transform_kind__&#34;, None)

    def get_settings_object(self):
        return presalytics.settings.XML_TRANSFORMS


XML_TRANSFORM_REGISTRY = None
&#34;&#34;&#34;
Static instance of `presalytics.lib.widgets.ooxml_editors.XmlTransformRegistry`.

Should not be used directly by consuming classes. Only initialized if a consuming
class or method calls the `presalytics.lib.widgets.ooxml_editors.get_transform_registry`.  This is done
for performance reasons since there&#39;s no need to build this registry at import-time if its never
used in a workspace.
&#34;&#34;&#34;


def get_transform_registry():
    &#34;&#34;&#34;
    Initalizes and retreives `presalytics.lib.widgets.ooxml_editors.XML_TRANSFORM_REGISTRY`
    &#34;&#34;&#34;
    global XML_TRANSFORM_REGISTRY
    if not XML_TRANSFORM_REGISTRY:
        XML_TRANSFORM_REGISTRY = XmlTransformRegistry()
    return XML_TRANSFORM_REGISTRY


class MultiXmlTransform(XmlTransformBase):
    &#34;&#34;&#34;
    This class allow users to run mutiple transforms on multiple targets in a single widget.  `MultiXmlTransform`
    wraps multiple subclasses of `presalytics.lib.widgets.ooxml_editors.XmlTransformBase`, creates instances of
    them, and feeds them into an `presalytics.lib.widgets.ooxml_editors.OoxmlEditorWidget` instance.  To do this,
    the `presalytics.lib.widgets.ooxml_editors.XmlTransformBase` subclasses must be loaded into the
    `presalytics.lib.widgets.ooxml_editors.XML_TRANSFORM_REGISTRY` when called.

    The function parameters for the

    Parameters
    ----------
    fail_quietly: bool, optional
        Defaults to false.  Indicates whether an exception should be raised when a subclass specified
        in the function parameters cannot not be found in the `presalytics.lib.widgets.ooxml_editors.XML_TRANSFORM_REGISTRY`
        instance.


    Function Parameters Dictionary
    ----------
    transforms_list: list of dict
        A list of dictionaries, with each item in the list consiting of a dictionary of two entries.
        The entries are as follows:

         * name: [str]
            The name of the the subclass of `presalytics.lib.widgets.ooxml_editors.XmlTransformBase` that
            will be that will be initialized

         * function_params: [dict]
            The `params` that will be the loaded into the instance&#39;s `transform_function`
    &#34;&#34;&#34;
    transform_instances: typing.List[XmlTransformBase]

    __xml_transform_name__ = &#34;MultiXmlTransform&#34;

    def __init__(self, transforms: typing.Dict[str, typing.List[typing.Dict[str, typing.Any]]], fail_quietly=True, **kwargs):
        super(MultiXmlTransform, self).__init__(transforms, **kwargs)
        transforms_list = transforms.get(&#34;transforms_list&#34;, None)
        self.fail_quietly = fail_quietly
        self.transform_instances = []
        self.transform_registry = get_transform_registry()
        for _transform in transforms_list:  # type: ignore
            key = &#34;XmlTransform.&#34; + _transform[&#34;name&#34;]
            transform_class = self.transform_registry.get(key)
            if not transform_class:
                message = &#34;Could not find XmlTransform with name &#39;{}&#39;&#34;.format(_transform[&#34;name&#34;])
                if self.fail_quietly:
                    logging.info(message)
                else:
                    raise self.transform_registry.raise_error(message)  # noqa
            else:
                inst = transform_class(_transform[&#34;function_params&#34;])
                self.transform_instances.append(inst)

    def transform_function(self, lxml_element, params):
        for inst in self.transform_instances:
            lxml_element = inst.execute(lxml_element)
        return lxml_element


class OoxmlEditorWidget(presalytics.lib.widgets.ooxml.OoxmlWidgetBase):
    &#34;&#34;&#34;
    Edits a `widget` from a Presentation or Spreadsheet document and renders
    the edited widget.

    This class interacts with the Presalytics API to extract SVG objects from
    Presentation and spreadsheet documents, from Presaltytics Ooxml Automation
    service objects that have already been loaded into the API.  This class requires
    that users supply `transform_function` by subclassing
    `presalytics.lib.widgets.ooxml_editors.XmlTransformBase`, and an optional set of
    parameters to act as variables in the transform function.

    Parameters
    ----------
    filename : str
        The local filepath a presentation or spreadsheet file containing
        the object to be rendered

    name : str
        The widget name.  If not provided, attribute will be set as the `object_name`
        or `filename`

    story_id : str
        The the id of the story in the Presalytics API Story service.  If not provided,
        a new story will be created.  Do not supply if this object has not yet been created.

    object_ooxml_id : str
        The identifier of the Ooxml Automation service object bound the Story. Do not supply if this
        object has not yet been created.

    endpoint_map : presalytics.lib.widgets.ooxml.OoxmlEndpointMap
        Reference to the Presalytics API Ooxml Automation service endpoint and object type
        that for the object of interest

    tranform_class : subclass of presalytics.lib.widgets.ooxml_editors.XmlTransformBase
        A class containing a `transform_function` method that transforms Open Office Xml via
        an `lxml.etree.Element` instance

    transform_params : dict, optional
        A dictionary of parameters that will be passed to the `transform_class`&#39;s `transform_function`
        as variables to modify the underlying OpenOfficeXml

    &#34;&#34;&#34;
    transform: XmlTransformBase

    __component_kind__ = &#39;ooxml-xml-editor&#39;

    def __init__(self,
                 name: str,
                 story_id,
                 object_ooxml_id,
                 endpoint_map,
                 transform_class,
                 transform_params={},
                 **kwargs):
        super(OoxmlEditorWidget, self).__init__(name, story_id=story_id, object_ooxml_id=object_ooxml_id, endpoint_map=endpoint_map, **kwargs)
        self.name = name
        self.transform = transform_class(transform_params)
        self.update()
        self.svg_html = self.create_container(**self.client_info)
        self.outline_widget = self.serialize()

    def update_xml(self, xml_str) -&gt; str:
        &#34;&#34;&#34;
        Runs the `transform_function` Open Office Xml data downloaded via the Presalytics API
        &#34;&#34;&#34;
        xml = lxml.etree.fromstring(xml_str)
        new_xml = self.transform.execute(xml)
        new_xml_str = lxml.etree.tostring(new_xml)
        return new_xml_str

    def update(self):
        &#34;&#34;&#34;
        Update the widget, include changes to the Xml
        &#34;&#34;&#34;
        client = self.get_client()
        headers = client.get_auth_header()
        headers.update(client.get_request_id_header())
        if self.transform:
            xml_url = self.endpoint_map.get_xml_url(self.object_ooxml_id)
            xml_response = requests.get(xml_url + &#34;?updated=false&#34;, headers=headers)
            if xml_response.status_code != 200:
                raise presalytics.lib.exceptions.ApiError(message=xml_response.text)
            dto = xml_response.json()
            new_xml = self.update_xml(dto[&#34;openOfficeXml&#34;])
            dto[&#34;openOfficeXml&#34;] = new_xml.decode(&#39;utf-8&#39;)
            xml_update_response = requests.put(xml_url, json=dto, headers=headers)
            if xml_response.status_code != 200:
                raise presalytics.lib.exceptions.ApiError(message=xml_update_response.content)

    @classmethod
    def deserialize(cls, component, **kwargs):
        endpoint_map = presalytics.lib.widgets.ooxml.OoxmlEndpointMap(component.data[&#34;endpoint_id&#34;])
        class_key = &#34;XmlTransform.&#34; + component.data.get(&#34;transform_class&#34;, &#34;&#34;)
        transform_class = get_transform_registry().get(class_key)
        transform_params = component.data.get(&#34;transform_params&#34;, {})
        return cls(component.name,
                   component.data[&#34;story_id&#34;],
                   component.data[&#34;object_ooxml_id&#34;],
                   endpoint_map,
                   transform_class=transform_class,
                   transform_params=transform_params,
                   **kwargs)

    def serialize(self, **kwargs):
        data = {
            &#34;story_id&#34;: self.story_id,
            &#34;object_ooxml_id&#34;: self.object_ooxml_id,
            &#34;endpoint_id&#34;: self.endpoint_map.endpoint_id,
            &#34;transform_class&#34;: self.transform.__xml_transform_name__,
            &#34;transform_params&#34;: self.transform.function_params
        }
        widget = presalytics.story.outline.Widget(
            name=self.name,
            data=data,
            kind=self.__component_kind__
        )
        return widget</code></pre>
</details>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-variables">Global variables</h2>
<dl>
<dt id="presalytics.lib.widgets.ooxml_editors.XML_TRANSFORM_REGISTRY"><code class="name">var <span class="ident">XML_TRANSFORM_REGISTRY</span></code></dt>
<dd>
<section class="desc"><p>Static instance of <code><a title="presalytics.lib.widgets.ooxml_editors.XmlTransformRegistry" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.XmlTransformRegistry">XmlTransformRegistry</a></code>.</p>
<p>Should not be used directly by consuming classes. Only initialized if a consuming
class or method calls the <code><a title="presalytics.lib.widgets.ooxml_editors.get_transform_registry" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.get_transform_registry">get_transform_registry()</a></code>.
This is done
for performance reasons since there's no need to build this registry at import-time if its never
used in a workspace.</p></section>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="presalytics.lib.widgets.ooxml_editors.get_transform_registry"><code class="name flex">
<span>def <span class="ident">get_transform_registry</span></span>(<span>)</span>
</code></dt>
<dd>
<section class="desc"><p>Initalizes and retreives <code><a title="presalytics.lib.widgets.ooxml_editors.XML_TRANSFORM_REGISTRY" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.XML_TRANSFORM_REGISTRY">XML_TRANSFORM_REGISTRY</a></code></p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/widgets/ooxml_editors.py#L332-L339" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def get_transform_registry():
    &#34;&#34;&#34;
    Initalizes and retreives `presalytics.lib.widgets.ooxml_editors.XML_TRANSFORM_REGISTRY`
    &#34;&#34;&#34;
    global XML_TRANSFORM_REGISTRY
    if not XML_TRANSFORM_REGISTRY:
        XML_TRANSFORM_REGISTRY = XmlTransformRegistry()
    return XML_TRANSFORM_REGISTRY</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="presalytics.lib.widgets.ooxml_editors.XmlTransformBase"><code class="flex name class">
<span>class <span class="ident">XmlTransformBase</span></span>
<span>(</span><span>function_params, *args, **kwargs)</span>
</code></dt>
<dd>
<section class="desc"><p>Base class for writing Open Office Xml tranform functions to be implemented
by <code><a title="presalytics.lib.widgets.ooxml_editors.OoxmlEditorWidget" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.OoxmlEditorWidget">OoxmlEditorWidget</a></code></p>
<p>*For more information about Open Office Xml Schema that underlies
.pptx and .xlsx files, see <a href="http://officeopenxml.com/">http://officeopenxml.com/</a></p>
<p>*For more information on how to lxml to write transforms, consult <a href="https://lxml.de/">https://lxml.de/</a></p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>function_params</code></strong> :&ensp;<code>dict</code></dt>
<dd>A dictionary containing variables that will be used when the <code>transform_function</code>
is executed</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/widgets/ooxml_editors.py#L19-L53" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class XmlTransformBase(abc.ABC):
    &#34;&#34;&#34;
    Base class for writing Open Office Xml tranform functions to be implemented
    by `presalytics.lib.widgets.ooxml_editors.OoxmlEditorWidget`

    *For more information about Open Office Xml Schema that underlies
    .pptx and .xlsx files, see http://officeopenxml.com/

    *For more information on how to lxml to write transforms, consult https://lxml.de/

    Parameters
    ----------
    function_params : dict
        A dictionary containing variables that will be used when the `transform_function`
        is executed
    &#34;&#34;&#34;
    __xml_transform_kind__ = &#39;XmlTransform&#39;

    def __init__(self, function_params: typing.Dict, *args, **kwargs):
        self.function_params = function_params

    @abc.abstractmethod
    def transform_function(self, lxml_element: lxml.etree.Element, params: typing.Dict) -&gt; lxml.etree.Element:
        &#34;&#34;&#34;
        Modifies Open Office Xml via transforming `lxml.etree.Element` using a params `dict` containing
        variables. Must be overridden in subclasses.
        &#34;&#34;&#34;
        pass

    def execute(self, lxml_element: lxml.etree.Element):
        &#34;&#34;&#34;
        Called by widget classes (e.g., `presalytics.lib.widgets.ooxml_editors.OoxmlEditorWidget`) to
        perform the updates prescribed in the `transform_function`
        &#34;&#34;&#34;
        return self.transform_function(lxml_element, self.function_params)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>abc.ABC</li>
</ul>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="presalytics.lib.widgets.ooxml_editors.ChangeShapeColor" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.ChangeShapeColor">ChangeShapeColor</a></li>
<li><a title="presalytics.lib.widgets.ooxml_editors.MultiXmlTransform" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.MultiXmlTransform">MultiXmlTransform</a></li>
<li><a title="presalytics.lib.widgets.ooxml_editors.TextReplace" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.TextReplace">TextReplace</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="presalytics.lib.widgets.ooxml_editors.XmlTransformBase.transform_function"><code class="name flex">
<span>def <span class="ident">transform_function</span></span>(<span>self, lxml_element, params)</span>
</code></dt>
<dd>
<section class="desc"><p>Modifies Open Office Xml via transforming <code>lxml.etree.Element</code> using a params <code>dict</code> containing
variables. Must be overridden in subclasses.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/widgets/ooxml_editors.py#L40-L46" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@abc.abstractmethod
def transform_function(self, lxml_element: lxml.etree.Element, params: typing.Dict) -&gt; lxml.etree.Element:
    &#34;&#34;&#34;
    Modifies Open Office Xml via transforming `lxml.etree.Element` using a params `dict` containing
    variables. Must be overridden in subclasses.
    &#34;&#34;&#34;
    pass</code></pre>
</details>
</dd>
<dt id="presalytics.lib.widgets.ooxml_editors.XmlTransformBase.execute"><code class="name flex">
<span>def <span class="ident">execute</span></span>(<span>self, lxml_element)</span>
</code></dt>
<dd>
<section class="desc"><p>Called by widget classes (e.g., <code><a title="presalytics.lib.widgets.ooxml_editors.OoxmlEditorWidget" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.OoxmlEditorWidget">OoxmlEditorWidget</a></code>) to
perform the updates prescribed in the <code>transform_function</code></p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/widgets/ooxml_editors.py#L48-L53" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def execute(self, lxml_element: lxml.etree.Element):
    &#34;&#34;&#34;
    Called by widget classes (e.g., `presalytics.lib.widgets.ooxml_editors.OoxmlEditorWidget`) to
    perform the updates prescribed in the `transform_function`
    &#34;&#34;&#34;
    return self.transform_function(lxml_element, self.function_params)</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="presalytics.lib.widgets.ooxml_editors.ChangeShapeColor"><code class="flex name class">
<span>class <span class="ident">ChangeShapeColor</span></span>
<span>(</span><span>function_params, *args, **kwargs)</span>
</code></dt>
<dd>
<section class="desc"><p>Changes the color of a set of <a href="http://officeopenxml.com/drwShape.php">Open Office Xml Shapes</a></p>
<h2 id="function-parameters-dictionary">Function Parameters Dictionary</h2>
<p>hex_color : str
The six-digit hexadecimal-format color string (e.g., ffa500 for orange).
See
<a href="https://www.color-hex.com/">https://www.color-hex.com/</a> for an example color calculator</p>
<p>object_name : str, optional
The object tree name of the target shape.
If not supplied, all descendent shapes will
have their color changed.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/widgets/ooxml_editors.py#L56-L131" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class ChangeShapeColor(XmlTransformBase):
    &#34;&#34;&#34;
    Changes the color of a set of [Open Office Xml Shapes](http://officeopenxml.com/drwShape.php)

    Function Parameters Dictionary
    ----------
    hex_color : str
        The six-digit hexadecimal-format color string (e.g., ffa500 for orange).  See
        https://www.color-hex.com/ for an example color calculator

    object_name : str, optional
        The object tree name of the target shape.  If not supplied, all descendent shapes will
        have their color changed.
    &#34;&#34;&#34;
    __xml_transform_name__ = &#34;ChangeShapeColor&#34;

    @staticmethod
    def replace_color_on_target_shape(shape_xml: lxml.etree.Element, new_color: str) -&gt; lxml.etree.Element:
        &#34;&#34;&#34;
        Changes the color of an [Open Office Xml Shape](http://officeopenxml.com/drwShape.php)
        &#34;&#34;&#34;
        new_fill = lxml.etree.Element(&#34;solidFill&#34;)
        lxml.etree.SubElement(new_fill, &#34;srbgClr&#34;, {&#34;val&#34;: new_color})
        fill_tags = [
            &#39;noFill&#39;,
            &#39;blipFill&#39;,
            &#39;gradFill&#39;,
            &#39;pattFill&#39;,
            &#39;solidFill&#39;
        ]
        props = shape_xml.find(&#39;.//{*}spPr&#39;)
        for child in props.getchildren():
            if any(re.search(&#39;{*}&#39; + r, child.tag) for r in fill_tags):
                current_nsmap = child.nsmap
                current_index = props.index(child)
                current_prefix = child.prefix
                current_ns = current_nsmap.get(current_prefix, None)
                new_fill = lxml.etree.Element(lxml.etree.QName(current_ns, &#34;solidFill&#34;), nsmap=current_nsmap)
                lxml.etree.SubElement(new_fill, lxml.etree.QName(current_ns, &#34;srgbClr&#34;), {&#34;val&#34;: new_color}, nsmap=current_nsmap)
                child.getparent().remove(child)
                props.insert(current_index, new_fill)
        return shape_xml

    def transform_function(self, lxml_element, params):
        &#34;&#34;&#34;
        Changes the color of an [Open Office Xml Shape](http://officeopenxml.com/drwShape.php)

        Parameters
        -----------
        lxml_element : lxml.etree.Element
            An element containing as least one an `&lt;sp&gt;` element

        params : dict
            See the `Function Parameters Dictionary` for required entries
        &#34;&#34;&#34;

        if re.match(&#39;{.*}sp&#39;, lxml_element.tag):
            shapes = [lxml_element]
        else:
            shapes = lxml_element.findall(&#39;.//{*}sp&#39;)
        object_name = params.get(&#34;object_name&#34;, None)
        color = params.get(&#34;hex_color&#34;).lstrip(&#34;#&#34;).upper()
        if object_name:
            for shape in shapes:
                is_target = False
                nvprops = shape.find(&#39;.//{*}nvSpPr&#39;)
                if len(nvprops) &gt; 0:
                    name = nvprops.find(&#39;.//*[@name]&#39;).get(&#34;name&#34;)
                    if name == object_name:
                        is_target = True
                if is_target:
                    shape = ChangeShapeColor.replace_color_on_target_shape(shape, color)
        else:
            for shape in shapes:
                shape = ChangeShapeColor.replace_color_on_target_shape(shape, color)
        return lxml_element</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="presalytics.lib.widgets.ooxml_editors.XmlTransformBase" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.XmlTransformBase">XmlTransformBase</a></li>
<li>abc.ABC</li>
</ul>
<h3>Static methods</h3>
<dl>
<dt id="presalytics.lib.widgets.ooxml_editors.ChangeShapeColor.replace_color_on_target_shape"><code class="name flex">
<span>def <span class="ident">replace_color_on_target_shape</span></span>(<span>shape_xml, new_color)</span>
</code></dt>
<dd>
<section class="desc"><p>Changes the color of an <a href="http://officeopenxml.com/drwShape.php">Open Office Xml Shape</a></p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/widgets/ooxml_editors.py#L72-L97" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@staticmethod
def replace_color_on_target_shape(shape_xml: lxml.etree.Element, new_color: str) -&gt; lxml.etree.Element:
    &#34;&#34;&#34;
    Changes the color of an [Open Office Xml Shape](http://officeopenxml.com/drwShape.php)
    &#34;&#34;&#34;
    new_fill = lxml.etree.Element(&#34;solidFill&#34;)
    lxml.etree.SubElement(new_fill, &#34;srbgClr&#34;, {&#34;val&#34;: new_color})
    fill_tags = [
        &#39;noFill&#39;,
        &#39;blipFill&#39;,
        &#39;gradFill&#39;,
        &#39;pattFill&#39;,
        &#39;solidFill&#39;
    ]
    props = shape_xml.find(&#39;.//{*}spPr&#39;)
    for child in props.getchildren():
        if any(re.search(&#39;{*}&#39; + r, child.tag) for r in fill_tags):
            current_nsmap = child.nsmap
            current_index = props.index(child)
            current_prefix = child.prefix
            current_ns = current_nsmap.get(current_prefix, None)
            new_fill = lxml.etree.Element(lxml.etree.QName(current_ns, &#34;solidFill&#34;), nsmap=current_nsmap)
            lxml.etree.SubElement(new_fill, lxml.etree.QName(current_ns, &#34;srgbClr&#34;), {&#34;val&#34;: new_color}, nsmap=current_nsmap)
            child.getparent().remove(child)
            props.insert(current_index, new_fill)
    return shape_xml</code></pre>
</details>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="presalytics.lib.widgets.ooxml_editors.ChangeShapeColor.transform_function"><code class="name flex">
<span>def <span class="ident">transform_function</span></span>(<span>self, lxml_element, params)</span>
</code></dt>
<dd>
<section class="desc"><p>Changes the color of an <a href="http://officeopenxml.com/drwShape.php">Open Office Xml Shape</a></p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>lxml_element</code></strong> :&ensp;<code>lxml.etree.Element</code></dt>
<dd>An element containing as least one an <code>&lt;sp&gt;</code> element</dd>
<dt><strong><code>params</code></strong> :&ensp;<code>dict</code></dt>
<dd>See the <code>Function Parameters Dictionary</code> for required entries</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/widgets/ooxml_editors.py#L99-L131" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def transform_function(self, lxml_element, params):
    &#34;&#34;&#34;
    Changes the color of an [Open Office Xml Shape](http://officeopenxml.com/drwShape.php)

    Parameters
    -----------
    lxml_element : lxml.etree.Element
        An element containing as least one an `&lt;sp&gt;` element

    params : dict
        See the `Function Parameters Dictionary` for required entries
    &#34;&#34;&#34;

    if re.match(&#39;{.*}sp&#39;, lxml_element.tag):
        shapes = [lxml_element]
    else:
        shapes = lxml_element.findall(&#39;.//{*}sp&#39;)
    object_name = params.get(&#34;object_name&#34;, None)
    color = params.get(&#34;hex_color&#34;).lstrip(&#34;#&#34;).upper()
    if object_name:
        for shape in shapes:
            is_target = False
            nvprops = shape.find(&#39;.//{*}nvSpPr&#39;)
            if len(nvprops) &gt; 0:
                name = nvprops.find(&#39;.//*[@name]&#39;).get(&#34;name&#34;)
                if name == object_name:
                    is_target = True
            if is_target:
                shape = ChangeShapeColor.replace_color_on_target_shape(shape, color)
    else:
        for shape in shapes:
            shape = ChangeShapeColor.replace_color_on_target_shape(shape, color)
    return lxml_element</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="presalytics.lib.widgets.ooxml_editors.XmlTransformBase" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.XmlTransformBase">XmlTransformBase</a></b></code>:
<ul class="hlist">
<li><code><a title="presalytics.lib.widgets.ooxml_editors.XmlTransformBase.execute" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.XmlTransformBase.execute">execute</a></code></li>
</ul>
</li>
</ul>
</dd>
<dt id="presalytics.lib.widgets.ooxml_editors.TextReplace"><code class="flex name class">
<span>class <span class="ident">TextReplace</span></span>
<span>(</span><span>function_params, *args, **kwargs)</span>
</code></dt>
<dd>
<section class="desc"><p>Replaces text in a template built into an Office Office Xml object that has
been uploaded to the Presalytics Ooxml Automation service.
Text to be should
be in the format of a "template tag", which is a string enclosed in handlebars
as such: '{{template_tag}}'</p>
<h2 id="function-parameters-dictionary">Function Parameters Dictionary</h2>
<p>replace_map: dict
A dictionary that maps template tags to the new strings that will replace the
tags in the rendered widget.
The the dictionary keys should not be enclosed in handlebars.</p>
<p>object_name: str, optional
The name of a sub object will be the target of this function.
If not includes, this will
default to the parent object.
Allows different replace map to be applied to multiple elements in
a widget</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/widgets/ooxml_editors.py#L134-L296" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class TextReplace(XmlTransformBase):
    &#34;&#34;&#34;
    Replaces text in a template built into an Office Office Xml object that has
    been uploaded to the Presalytics Ooxml Automation service.  Text to be should
    be in the format of a &#34;template tag&#34;, which is a string enclosed in handlebars
    as such: &#39;{{template_tag}}&#39;

    Function Parameters Dictionary
    ----------

    replace_map: dict
        A dictionary that maps template tags to the new strings that will replace the
        tags in the rendered widget.  The the dictionary keys should not be enclosed in handlebars.

    object_name: str, optional
        The name of a sub object will be the target of this function.  If not includes, this will
        default to the parent object.  Allows different replace map to be applied to multiple elements in
        a widget

    &#34;&#34;&#34;
    __xml_transform_name__ = &#34;TextReplace&#34;

    class TextElementInfo(object):
        &#34;&#34;&#34;
        Holds metadata for a list of `&lt;t&gt;` tags from an Office Open Xml document.
        &#34;&#34;&#34;

        def __init__(self, element: lxml.etree.Element, start_position: int):
            self.element = element
            self.text = &#34;&#34; if not element.text else element.text
            self.length = len(self.text)
            self.start_position = start_position
            self.end_position = self.start_position + self.length - 1

    class TextList(object):
        &#34;&#34;&#34;
        Class for managing a list of `TextElementInfo` objects
        &#34;&#34;&#34;
        _list: typing.List[&#39;TextReplace.TextElementInfo&#39;]

        def __init__(self):
            self._list = []

        def append(self, text_element_info):
            if isinstance(text_element_info, globals()[&#39;TextReplace&#39;].TextElementInfo):
                self._list.append(text_element_info)
            else:
                raise presalytics.lib.exceptions.InvalidArgumentException(message=&#34;Argument must be an instance of class &#39;TextElementInfo&#39;&#34;)

        def set_text(self, index, new_string):
            self._list[index].text = new_string
            self._list[index].element.text = new_string

        def get_text(self, index):
            return self._list[index].text

        def get_plaintext_string(self):
            ret = &#34;&#34;
            for item in self._list:
                ret += item.text
            return ret

        def get_position(self, match_strings):
            for potential_match in match_strings:
                i = self.get_plaintext_string().find(potential_match)
                if i &gt;= 0:
                    break
            return i, potential_match

        def get_list_index_of_position(self, position: int):
            for item in self._list:
                if item.start_position &lt;= position and item.end_position &gt;= position:
                    return self.get_index(item)
            raise presalytics.lib.exceptions.InvalidArgumentException(message=&#34;Position {} out of range&#34;.format(position))

        def get_index(self, text_element_info: &#39;TextReplace.TextElementInfo&#39;):
            for i in range(len(self._list)):
                if self._list[i] == text_element_info:
                    return i
            raise presalytics.lib.exceptions.InvalidArgumentException(message=&#34;Supplied argument on in self._list&#34;)

        def set_text_to_empty_string(self, index):
            self._list[index].text = &#34;&#34;
            self._list[index].element.text = &#34;&#34;

        def set_start_to_new_value(self, index, new_value):
            start_text, remainder = self._list[index].text.split(&#34;{{&#34;, 1)
            end = &#34;&#34;
            if &#34;}}&#34; in remainder:
                end = remainder.split(&#34;}}&#34;, 1)[1]
            new_text = &#34;{0}{1}{2}&#34;.format(start_text, new_value, end)
            self._list[index].text = new_text
            self._list[index].element.text = new_text

        def truncate_end(self, index):
            end_text = self._list[index].text.split(&#34;}}&#34;, 1)[-1]
            self._list[index].text = end_text
            self._list[index].element.text = end_text

        def plaintext_string_list(self):
            return [x.text for x in self._list]

        def reset(self):
            for i in range(0, len(self._list)):
                start_position = 0 if i == 0 else self._list[i - 1].end_position + 1
                self._list[i] = TextReplace.TextElementInfo(self._list[i].element, start_position)

    def replace_handlebars(self, info_list, params):
        &#34;&#34;&#34;
        Method that finds template tags and replaces them

        TODO: Upgrade to Liquid Syntax (or similar)
        &#34;&#34;&#34;
        for key, val in params.items():
            match_keys = [&#34;{{&#34; + key + &#34;}}&#34;, &#34;{{ &#34; + key + &#34; }}&#34;]
            match_start_position, match_key = info_list.get_position(match_keys)
            if match_start_position &gt; -1:
                match_end_position = match_start_position + len(match_key) - 1
                match_start_index = info_list.get_list_index_of_position(match_start_position)
                match_end_index = info_list.get_list_index_of_position(match_end_position)
                if match_start_index &lt; match_end_index:
                    info_list.truncate_end(match_end_index)
                for i in range(match_start_index + 1, match_end_index):
                    info_list.set_text_to_empty_string(i)
                info_list.set_start_to_new_value(match_start_index, val)
                info_list.reset()
                self.replace_handlebars(info_list, params)

    def transform_function(self, lxml_element, params):
        &#34;&#34;&#34;
        Replaces template tags located {{inside_handlebars}} that match keys in the
        `params` dict with values from the `params` dict.

        This method searches for match for plain text strings, so that if template
        tags are split across xml `&lt;t&gt;` elements, they are still identified and replaced.

        Parameters
        -----------
        lxml_element : lxml.etree.Element
            An element containing as least one an `&lt;t&gt;` element

        params : dict
            A dictionary that maps template tags (no handlebars) to their respective
            replacement values.
        &#34;&#34;&#34;
        target_object = lxml_element
        target_object_name = params.get(&#34;object_name&#34;, None)
        if target_object_name:
            nvProps = lxml_element.findall(&#39;.//{*}cNvPr&#39;)
            for ele in nvProps:
                if ele.get(&#34;name&#34;, None) == target_object_name:
                    target_object = ele.getparent().getparent()
                    break

        text_list = target_object.findall(&#39;.//{*}t&#39;)
        info_list = TextReplace.TextList()
        position = 0
        for tag in text_list:
            info = self.TextElementInfo(tag, position)
            position = info.end_position + 1
            info_list.append(info)
        self.replace_handlebars(info_list, params.get(&#34;replace_map&#34;))
        return lxml_element</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="presalytics.lib.widgets.ooxml_editors.XmlTransformBase" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.XmlTransformBase">XmlTransformBase</a></li>
<li>abc.ABC</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="presalytics.lib.widgets.ooxml_editors.TextReplace.TextElementInfo"><code class="name">var <span class="ident">TextElementInfo</span></code></dt>
<dd>
<section class="desc"><p>Holds metadata for a list of <code>&lt;t&gt;</code> tags from an Office Open Xml document.</p></section>
</dd>
<dt id="presalytics.lib.widgets.ooxml_editors.TextReplace.TextList"><code class="name">var <span class="ident">TextList</span></code></dt>
<dd>
<section class="desc"><p>Class for managing a list of <code>TextElementInfo</code> objects</p></section>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="presalytics.lib.widgets.ooxml_editors.TextReplace.replace_handlebars"><code class="name flex">
<span>def <span class="ident">replace_handlebars</span></span>(<span>self, info_list, params)</span>
</code></dt>
<dd>
<section class="desc"><p>Method that finds template tags and replaces them</p>
<p>TODO: Upgrade to Liquid Syntax (or similar)</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/widgets/ooxml_editors.py#L241-L260" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def replace_handlebars(self, info_list, params):
    &#34;&#34;&#34;
    Method that finds template tags and replaces them

    TODO: Upgrade to Liquid Syntax (or similar)
    &#34;&#34;&#34;
    for key, val in params.items():
        match_keys = [&#34;{{&#34; + key + &#34;}}&#34;, &#34;{{ &#34; + key + &#34; }}&#34;]
        match_start_position, match_key = info_list.get_position(match_keys)
        if match_start_position &gt; -1:
            match_end_position = match_start_position + len(match_key) - 1
            match_start_index = info_list.get_list_index_of_position(match_start_position)
            match_end_index = info_list.get_list_index_of_position(match_end_position)
            if match_start_index &lt; match_end_index:
                info_list.truncate_end(match_end_index)
            for i in range(match_start_index + 1, match_end_index):
                info_list.set_text_to_empty_string(i)
            info_list.set_start_to_new_value(match_start_index, val)
            info_list.reset()
            self.replace_handlebars(info_list, params)</code></pre>
</details>
</dd>
<dt id="presalytics.lib.widgets.ooxml_editors.TextReplace.transform_function"><code class="name flex">
<span>def <span class="ident">transform_function</span></span>(<span>self, lxml_element, params)</span>
</code></dt>
<dd>
<section class="desc"><p>Replaces template tags located {{inside_handlebars}} that match keys in the
<code>params</code> dict with values from the <code>params</code> dict.</p>
<p>This method searches for match for plain text strings, so that if template
tags are split across xml <code>&lt;t&gt;</code> elements, they are still identified and replaced.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>lxml_element</code></strong> :&ensp;<code>lxml.etree.Element</code></dt>
<dd>An element containing as least one an <code>&lt;t&gt;</code> element</dd>
<dt><strong><code>params</code></strong> :&ensp;<code>dict</code></dt>
<dd>A dictionary that maps template tags (no handlebars) to their respective
replacement values.</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/widgets/ooxml_editors.py#L262-L296" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def transform_function(self, lxml_element, params):
    &#34;&#34;&#34;
    Replaces template tags located {{inside_handlebars}} that match keys in the
    `params` dict with values from the `params` dict.

    This method searches for match for plain text strings, so that if template
    tags are split across xml `&lt;t&gt;` elements, they are still identified and replaced.

    Parameters
    -----------
    lxml_element : lxml.etree.Element
        An element containing as least one an `&lt;t&gt;` element

    params : dict
        A dictionary that maps template tags (no handlebars) to their respective
        replacement values.
    &#34;&#34;&#34;
    target_object = lxml_element
    target_object_name = params.get(&#34;object_name&#34;, None)
    if target_object_name:
        nvProps = lxml_element.findall(&#39;.//{*}cNvPr&#39;)
        for ele in nvProps:
            if ele.get(&#34;name&#34;, None) == target_object_name:
                target_object = ele.getparent().getparent()
                break

    text_list = target_object.findall(&#39;.//{*}t&#39;)
    info_list = TextReplace.TextList()
    position = 0
    for tag in text_list:
        info = self.TextElementInfo(tag, position)
        position = info.end_position + 1
        info_list.append(info)
    self.replace_handlebars(info_list, params.get(&#34;replace_map&#34;))
    return lxml_element</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="presalytics.lib.widgets.ooxml_editors.XmlTransformBase" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.XmlTransformBase">XmlTransformBase</a></b></code>:
<ul class="hlist">
<li><code><a title="presalytics.lib.widgets.ooxml_editors.XmlTransformBase.execute" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.XmlTransformBase.execute">execute</a></code></li>
</ul>
</li>
</ul>
</dd>
<dt id="presalytics.lib.widgets.ooxml_editors.XmlTransformRegistry"><code class="flex name class">
<span>class <span class="ident">XmlTransformRegistry</span></span>
</code></dt>
<dd>
<section class="desc"><p>Registry for XmlTransform Classes.
Read by <code><a title="presalytics.lib.widgets.ooxml_editors.MultiXmlTransform" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.MultiXmlTransform">MultiXmlTransform</a></code>
and <code><a title="presalytics.lib.widgets.ooxml_editors.OoxmlEditorWidget" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.OoxmlEditorWidget">OoxmlEditorWidget</a></code> so XmlTransformBase subclasses
can be deserialized at run-time without a loaded instance in <code>locals()</code>.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/widgets/ooxml_editors.py#L299-L318" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class XmlTransformRegistry(presalytics.lib.registry.RegistryBase):
    &#34;&#34;&#34;
    Registry for XmlTransform Classes.  Read by `presalytics.lib.widgets.ooxml_editors.MultiXmlTransform`
    and `presalytics.lib.widgets.ooxml_editors.OoxmlEditorWidget` so XmlTransformBase subclasses
    can be deserialized at run-time without a loaded instance in `locals()`.
    &#34;&#34;&#34;

    def __init__(self):
        include_paths = presalytics.COMPONENTS.autodiscover_paths  # todo: Change this line -does not exist at timport time.
        reserved_names = presalytics.COMPONENTS.reserved_names
        super(XmlTransformRegistry, self).__init__(autodiscover_paths=include_paths, reserved_names=reserved_names)

    def get_name(self, klass):
        return getattr(klass, &#34;__xml_transform_name__&#34;, None)

    def get_type(self, klass):
        return getattr(klass, &#34;__xml_transform_kind__&#34;, None)

    def get_settings_object(self):
        return presalytics.settings.XML_TRANSFORMS</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="presalytics.lib.registry.RegistryBase" href="/python-client/presalytics/lib/registry.html#presalytics.lib.registry.RegistryBase">RegistryBase</a></li>
<li>abc.ABC</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="presalytics.lib.widgets.ooxml_editors.XmlTransformRegistry.registry"><code class="name">var <span class="ident">registry</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="presalytics.lib.widgets.ooxml_editors.XmlTransformRegistry.deferred_modules"><code class="name">var <span class="ident">deferred_modules</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="presalytics.lib.widgets.ooxml_editors.XmlTransformRegistry.get_name"><code class="name flex">
<span>def <span class="ident">get_name</span></span>(<span>self, klass)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/widgets/ooxml_editors.py#L311-L312" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def get_name(self, klass):
    return getattr(klass, &#34;__xml_transform_name__&#34;, None)</code></pre>
</details>
</dd>
<dt id="presalytics.lib.widgets.ooxml_editors.XmlTransformRegistry.get_type"><code class="name flex">
<span>def <span class="ident">get_type</span></span>(<span>self, klass)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/widgets/ooxml_editors.py#L314-L315" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def get_type(self, klass):
    return getattr(klass, &#34;__xml_transform_kind__&#34;, None)</code></pre>
</details>
</dd>
<dt id="presalytics.lib.widgets.ooxml_editors.XmlTransformRegistry.get_settings_object"><code class="name flex">
<span>def <span class="ident">get_settings_object</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/widgets/ooxml_editors.py#L317-L318" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def get_settings_object(self):
    return presalytics.settings.XML_TRANSFORMS</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="presalytics.lib.registry.RegistryBase" href="/python-client/presalytics/lib/registry.html#presalytics.lib.registry.RegistryBase">RegistryBase</a></b></code>:
<ul class="hlist">
<li><code><a title="presalytics.lib.registry.RegistryBase.module_is_in_stackframe" href="/python-client/presalytics/lib/registry.html#presalytics.lib.registry.RegistryBase.module_is_in_stackframe">module_is_in_stackframe</a></code></li>
<li><code><a title="presalytics.lib.registry.RegistryBase.register" href="/python-client/presalytics/lib/registry.html#presalytics.lib.registry.RegistryBase.register">register</a></code></li>
</ul>
</li>
</ul>
</dd>
<dt id="presalytics.lib.widgets.ooxml_editors.MultiXmlTransform"><code class="flex name class">
<span>class <span class="ident">MultiXmlTransform</span></span>
<span>(</span><span>transforms, fail_quietly=True, **kwargs)</span>
</code></dt>
<dd>
<section class="desc"><p>This class allow users to run mutiple transforms on multiple targets in a single widget.
<code><a title="presalytics.lib.widgets.ooxml_editors.MultiXmlTransform" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.MultiXmlTransform">MultiXmlTransform</a></code>
wraps multiple subclasses of <code><a title="presalytics.lib.widgets.ooxml_editors.XmlTransformBase" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.XmlTransformBase">XmlTransformBase</a></code>, creates instances of
them, and feeds them into an <code><a title="presalytics.lib.widgets.ooxml_editors.OoxmlEditorWidget" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.OoxmlEditorWidget">OoxmlEditorWidget</a></code> instance.
To do this,
the <code><a title="presalytics.lib.widgets.ooxml_editors.XmlTransformBase" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.XmlTransformBase">XmlTransformBase</a></code> subclasses must be loaded into the
<code><a title="presalytics.lib.widgets.ooxml_editors.XML_TRANSFORM_REGISTRY" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.XML_TRANSFORM_REGISTRY">XML_TRANSFORM_REGISTRY</a></code> when called.</p>
<p>The function parameters for the</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>fail_quietly</code></strong> :&ensp;<code>bool</code>, optional</dt>
<dd>Defaults to false.
Indicates whether an exception should be raised when a subclass specified
in the function parameters cannot not be found in the <code><a title="presalytics.lib.widgets.ooxml_editors.XML_TRANSFORM_REGISTRY" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.XML_TRANSFORM_REGISTRY">XML_TRANSFORM_REGISTRY</a></code>
instance.</dd>
</dl>
<h2 id="function-parameters-dictionary">Function Parameters Dictionary</h2>
<p>transforms_list: list of dict
A list of dictionaries, with each item in the list consiting of a dictionary of two entries.
The entries are as follows:</p>
<pre><code> * name: [str]
    The name of the the subclass of &lt;code&gt;&lt;a title="presalytics.lib.widgets.ooxml_editors.XmlTransformBase" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.XmlTransformBase"&gt;XmlTransformBase&lt;/a&gt;&lt;/code&gt; that
    will be that will be initialized

 * function_params: [dict]
    The &lt;code&gt;params&lt;/code&gt; that will be the loaded into the instance's &lt;code&gt;transform\_function&lt;/code&gt;
</code></pre></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/widgets/ooxml_editors.py#L342-L399" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class MultiXmlTransform(XmlTransformBase):
    &#34;&#34;&#34;
    This class allow users to run mutiple transforms on multiple targets in a single widget.  `MultiXmlTransform`
    wraps multiple subclasses of `presalytics.lib.widgets.ooxml_editors.XmlTransformBase`, creates instances of
    them, and feeds them into an `presalytics.lib.widgets.ooxml_editors.OoxmlEditorWidget` instance.  To do this,
    the `presalytics.lib.widgets.ooxml_editors.XmlTransformBase` subclasses must be loaded into the
    `presalytics.lib.widgets.ooxml_editors.XML_TRANSFORM_REGISTRY` when called.

    The function parameters for the

    Parameters
    ----------
    fail_quietly: bool, optional
        Defaults to false.  Indicates whether an exception should be raised when a subclass specified
        in the function parameters cannot not be found in the `presalytics.lib.widgets.ooxml_editors.XML_TRANSFORM_REGISTRY`
        instance.


    Function Parameters Dictionary
    ----------
    transforms_list: list of dict
        A list of dictionaries, with each item in the list consiting of a dictionary of two entries.
        The entries are as follows:

         * name: [str]
            The name of the the subclass of `presalytics.lib.widgets.ooxml_editors.XmlTransformBase` that
            will be that will be initialized

         * function_params: [dict]
            The `params` that will be the loaded into the instance&#39;s `transform_function`
    &#34;&#34;&#34;
    transform_instances: typing.List[XmlTransformBase]

    __xml_transform_name__ = &#34;MultiXmlTransform&#34;

    def __init__(self, transforms: typing.Dict[str, typing.List[typing.Dict[str, typing.Any]]], fail_quietly=True, **kwargs):
        super(MultiXmlTransform, self).__init__(transforms, **kwargs)
        transforms_list = transforms.get(&#34;transforms_list&#34;, None)
        self.fail_quietly = fail_quietly
        self.transform_instances = []
        self.transform_registry = get_transform_registry()
        for _transform in transforms_list:  # type: ignore
            key = &#34;XmlTransform.&#34; + _transform[&#34;name&#34;]
            transform_class = self.transform_registry.get(key)
            if not transform_class:
                message = &#34;Could not find XmlTransform with name &#39;{}&#39;&#34;.format(_transform[&#34;name&#34;])
                if self.fail_quietly:
                    logging.info(message)
                else:
                    raise self.transform_registry.raise_error(message)  # noqa
            else:
                inst = transform_class(_transform[&#34;function_params&#34;])
                self.transform_instances.append(inst)

    def transform_function(self, lxml_element, params):
        for inst in self.transform_instances:
            lxml_element = inst.execute(lxml_element)
        return lxml_element</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="presalytics.lib.widgets.ooxml_editors.XmlTransformBase" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.XmlTransformBase">XmlTransformBase</a></li>
<li>abc.ABC</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="presalytics.lib.widgets.ooxml_editors.MultiXmlTransform.transform_instances"><code class="name">var <span class="ident">transform_instances</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="presalytics.lib.widgets.ooxml_editors.XmlTransformBase" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.XmlTransformBase">XmlTransformBase</a></b></code>:
<ul class="hlist">
<li><code><a title="presalytics.lib.widgets.ooxml_editors.XmlTransformBase.execute" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.XmlTransformBase.execute">execute</a></code></li>
<li><code><a title="presalytics.lib.widgets.ooxml_editors.XmlTransformBase.transform_function" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.XmlTransformBase.transform_function">transform_function</a></code></li>
</ul>
</li>
</ul>
</dd>
<dt id="presalytics.lib.widgets.ooxml_editors.OoxmlEditorWidget"><code class="flex name class">
<span>class <span class="ident">OoxmlEditorWidget</span></span>
<span>(</span><span>name, story_id, object_ooxml_id, endpoint_map, transform_class, transform_params={}, **kwargs)</span>
</code></dt>
<dd>
<section class="desc"><p>Edits a <code>widget</code> from a Presentation or Spreadsheet document and renders
the edited widget.</p>
<p>This class interacts with the Presalytics API to extract SVG objects from
Presentation and spreadsheet documents, from Presaltytics Ooxml Automation
service objects that have already been loaded into the API.
This class requires
that users supply <code>transform_function</code> by subclassing
<code><a title="presalytics.lib.widgets.ooxml_editors.XmlTransformBase" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.XmlTransformBase">XmlTransformBase</a></code>, and an optional set of
parameters to act as variables in the transform function.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>filename</code></strong> :&ensp;<code>str</code></dt>
<dd>The local filepath a presentation or spreadsheet file containing
the object to be rendered</dd>
<dt><strong><code>name</code></strong> :&ensp;<code>str</code></dt>
<dd>The widget name.
If not provided, attribute will be set as the <code>object_name</code>
or <code>filename</code></dd>
<dt><strong><code>story_id</code></strong> :&ensp;<code>str</code></dt>
<dd>The the id of the story in the Presalytics API Story service.
If not provided,
a new story will be created.
Do not supply if this object has not yet been created.</dd>
<dt><strong><code>object_ooxml_id</code></strong> :&ensp;<code>str</code></dt>
<dd>The identifier of the Ooxml Automation service object bound the Story. Do not supply if this
object has not yet been created.</dd>
<dt><strong><code>endpoint_map</code></strong> :&ensp;<code><a title="presalytics.lib.widgets.ooxml.OoxmlEndpointMap" href="/python-client/presalytics/lib/widgets/ooxml.html#presalytics.lib.widgets.ooxml.OoxmlEndpointMap">OoxmlEndpointMap</a></code></dt>
<dd>Reference to the Presalytics API Ooxml Automation service endpoint and object type
that for the object of interest</dd>
<dt><strong><code>tranform_class</code></strong> :&ensp;<code>subclass</code> of <code><a title="presalytics.lib.widgets.ooxml_editors.XmlTransformBase" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.XmlTransformBase">XmlTransformBase</a></code></dt>
<dd>A class containing a <code>transform_function</code> method that transforms Open Office Xml via
an <code>lxml.etree.Element</code> instance</dd>
<dt><strong><code>transform_params</code></strong> :&ensp;<code>dict</code>, optional</dt>
<dd>A dictionary of parameters that will be passed to the <code>transform_class</code>'s <code>transform_function</code>
as variables to modify the underlying OpenOfficeXml</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/widgets/ooxml_editors.py#L402-L519" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class OoxmlEditorWidget(presalytics.lib.widgets.ooxml.OoxmlWidgetBase):
    &#34;&#34;&#34;
    Edits a `widget` from a Presentation or Spreadsheet document and renders
    the edited widget.

    This class interacts with the Presalytics API to extract SVG objects from
    Presentation and spreadsheet documents, from Presaltytics Ooxml Automation
    service objects that have already been loaded into the API.  This class requires
    that users supply `transform_function` by subclassing
    `presalytics.lib.widgets.ooxml_editors.XmlTransformBase`, and an optional set of
    parameters to act as variables in the transform function.

    Parameters
    ----------
    filename : str
        The local filepath a presentation or spreadsheet file containing
        the object to be rendered

    name : str
        The widget name.  If not provided, attribute will be set as the `object_name`
        or `filename`

    story_id : str
        The the id of the story in the Presalytics API Story service.  If not provided,
        a new story will be created.  Do not supply if this object has not yet been created.

    object_ooxml_id : str
        The identifier of the Ooxml Automation service object bound the Story. Do not supply if this
        object has not yet been created.

    endpoint_map : presalytics.lib.widgets.ooxml.OoxmlEndpointMap
        Reference to the Presalytics API Ooxml Automation service endpoint and object type
        that for the object of interest

    tranform_class : subclass of presalytics.lib.widgets.ooxml_editors.XmlTransformBase
        A class containing a `transform_function` method that transforms Open Office Xml via
        an `lxml.etree.Element` instance

    transform_params : dict, optional
        A dictionary of parameters that will be passed to the `transform_class`&#39;s `transform_function`
        as variables to modify the underlying OpenOfficeXml

    &#34;&#34;&#34;
    transform: XmlTransformBase

    __component_kind__ = &#39;ooxml-xml-editor&#39;

    def __init__(self,
                 name: str,
                 story_id,
                 object_ooxml_id,
                 endpoint_map,
                 transform_class,
                 transform_params={},
                 **kwargs):
        super(OoxmlEditorWidget, self).__init__(name, story_id=story_id, object_ooxml_id=object_ooxml_id, endpoint_map=endpoint_map, **kwargs)
        self.name = name
        self.transform = transform_class(transform_params)
        self.update()
        self.svg_html = self.create_container(**self.client_info)
        self.outline_widget = self.serialize()

    def update_xml(self, xml_str) -&gt; str:
        &#34;&#34;&#34;
        Runs the `transform_function` Open Office Xml data downloaded via the Presalytics API
        &#34;&#34;&#34;
        xml = lxml.etree.fromstring(xml_str)
        new_xml = self.transform.execute(xml)
        new_xml_str = lxml.etree.tostring(new_xml)
        return new_xml_str

    def update(self):
        &#34;&#34;&#34;
        Update the widget, include changes to the Xml
        &#34;&#34;&#34;
        client = self.get_client()
        headers = client.get_auth_header()
        headers.update(client.get_request_id_header())
        if self.transform:
            xml_url = self.endpoint_map.get_xml_url(self.object_ooxml_id)
            xml_response = requests.get(xml_url + &#34;?updated=false&#34;, headers=headers)
            if xml_response.status_code != 200:
                raise presalytics.lib.exceptions.ApiError(message=xml_response.text)
            dto = xml_response.json()
            new_xml = self.update_xml(dto[&#34;openOfficeXml&#34;])
            dto[&#34;openOfficeXml&#34;] = new_xml.decode(&#39;utf-8&#39;)
            xml_update_response = requests.put(xml_url, json=dto, headers=headers)
            if xml_response.status_code != 200:
                raise presalytics.lib.exceptions.ApiError(message=xml_update_response.content)

    @classmethod
    def deserialize(cls, component, **kwargs):
        endpoint_map = presalytics.lib.widgets.ooxml.OoxmlEndpointMap(component.data[&#34;endpoint_id&#34;])
        class_key = &#34;XmlTransform.&#34; + component.data.get(&#34;transform_class&#34;, &#34;&#34;)
        transform_class = get_transform_registry().get(class_key)
        transform_params = component.data.get(&#34;transform_params&#34;, {})
        return cls(component.name,
                   component.data[&#34;story_id&#34;],
                   component.data[&#34;object_ooxml_id&#34;],
                   endpoint_map,
                   transform_class=transform_class,
                   transform_params=transform_params,
                   **kwargs)

    def serialize(self, **kwargs):
        data = {
            &#34;story_id&#34;: self.story_id,
            &#34;object_ooxml_id&#34;: self.object_ooxml_id,
            &#34;endpoint_id&#34;: self.endpoint_map.endpoint_id,
            &#34;transform_class&#34;: self.transform.__xml_transform_name__,
            &#34;transform_params&#34;: self.transform.function_params
        }
        widget = presalytics.story.outline.Widget(
            name=self.name,
            data=data,
            kind=self.__component_kind__
        )
        return widget</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="presalytics.lib.widgets.ooxml.OoxmlWidgetBase" href="/python-client/presalytics/lib/widgets/ooxml.html#presalytics.lib.widgets.ooxml.OoxmlWidgetBase">OoxmlWidgetBase</a></li>
<li><a title="presalytics.story.components.WidgetBase" href="/python-client/presalytics/story/components.html#presalytics.story.components.WidgetBase">WidgetBase</a></li>
<li><a title="presalytics.story.components.ComponentBase" href="/python-client/presalytics/story/components.html#presalytics.story.components.ComponentBase">ComponentBase</a></li>
<li>abc.ABC</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="presalytics.lib.widgets.ooxml_editors.OoxmlEditorWidget.transform"><code class="name">var <span class="ident">transform</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="presalytics.lib.widgets.ooxml_editors.OoxmlEditorWidget.update_xml"><code class="name flex">
<span>def <span class="ident">update_xml</span></span>(<span>self, xml_str)</span>
</code></dt>
<dd>
<section class="desc"><p>Runs the <code>transform_function</code> Open Office Xml data downloaded via the Presalytics API</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/widgets/ooxml_editors.py#L464-L471" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def update_xml(self, xml_str) -&gt; str:
    &#34;&#34;&#34;
    Runs the `transform_function` Open Office Xml data downloaded via the Presalytics API
    &#34;&#34;&#34;
    xml = lxml.etree.fromstring(xml_str)
    new_xml = self.transform.execute(xml)
    new_xml_str = lxml.etree.tostring(new_xml)
    return new_xml_str</code></pre>
</details>
</dd>
<dt id="presalytics.lib.widgets.ooxml_editors.OoxmlEditorWidget.update"><code class="name flex">
<span>def <span class="ident">update</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>Update the widget, include changes to the Xml</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/lib/widgets/ooxml_editors.py#L473-L490" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def update(self):
    &#34;&#34;&#34;
    Update the widget, include changes to the Xml
    &#34;&#34;&#34;
    client = self.get_client()
    headers = client.get_auth_header()
    headers.update(client.get_request_id_header())
    if self.transform:
        xml_url = self.endpoint_map.get_xml_url(self.object_ooxml_id)
        xml_response = requests.get(xml_url + &#34;?updated=false&#34;, headers=headers)
        if xml_response.status_code != 200:
            raise presalytics.lib.exceptions.ApiError(message=xml_response.text)
        dto = xml_response.json()
        new_xml = self.update_xml(dto[&#34;openOfficeXml&#34;])
        dto[&#34;openOfficeXml&#34;] = new_xml.decode(&#39;utf-8&#39;)
        xml_update_response = requests.put(xml_url, json=dto, headers=headers)
        if xml_response.status_code != 200:
            raise presalytics.lib.exceptions.ApiError(message=xml_update_response.content)</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="presalytics.lib.widgets.ooxml.OoxmlWidgetBase" href="/python-client/presalytics/lib/widgets/ooxml.html#presalytics.lib.widgets.ooxml.OoxmlWidgetBase">OoxmlWidgetBase</a></b></code>:
<ul class="hlist">
<li><code><a title="presalytics.lib.widgets.ooxml.OoxmlWidgetBase.create_container" href="/python-client/presalytics/lib/widgets/ooxml.html#presalytics.lib.widgets.ooxml.OoxmlWidgetBase.create_container">create_container</a></code></li>
<li><code><a title="presalytics.lib.widgets.ooxml.OoxmlWidgetBase.create_subdocument" href="/python-client/presalytics/story/components.html#presalytics.story.components.WidgetBase.create_subdocument">create_subdocument</a></code></li>
<li><code><a title="presalytics.lib.widgets.ooxml.OoxmlWidgetBase.deserialize" href="/python-client/presalytics/story/components.html#presalytics.story.components.WidgetBase.deserialize">deserialize</a></code></li>
<li><code><a title="presalytics.lib.widgets.ooxml.OoxmlWidgetBase.get_client" href="/python-client/presalytics/story/components.html#presalytics.story.components.ComponentBase.get_client">get_client</a></code></li>
<li><code><a title="presalytics.lib.widgets.ooxml.OoxmlWidgetBase.get_svg" href="/python-client/presalytics/lib/widgets/ooxml.html#presalytics.lib.widgets.ooxml.OoxmlWidgetBase.get_svg">get_svg</a></code></li>
<li><code><a title="presalytics.lib.widgets.ooxml.OoxmlWidgetBase.get_svg_file" href="/python-client/presalytics/lib/widgets/ooxml.html#presalytics.lib.widgets.ooxml.OoxmlWidgetBase.get_svg_file">get_svg_file</a></code></li>
<li><code><a title="presalytics.lib.widgets.ooxml.OoxmlWidgetBase.render" href="/python-client/presalytics/story/components.html#presalytics.story.components.ComponentBase.render">render</a></code></li>
<li><code><a title="presalytics.lib.widgets.ooxml.OoxmlWidgetBase.serialize" href="/python-client/presalytics/story/components.html#presalytics.story.components.WidgetBase.serialize">serialize</a></code></li>
<li><code><a title="presalytics.lib.widgets.ooxml.OoxmlWidgetBase.to_html" href="/python-client/presalytics/lib/widgets/ooxml.html#presalytics.lib.widgets.ooxml.OoxmlWidgetBase.to_html">to_html</a></code></li>
</ul>
</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="presalytics.lib.widgets" href="/python-client/presalytics/lib/widgets/index.html">presalytics.lib.widgets</a></code></li>
</ul>
</li>
<li><h3><a href="#header-variables">Global variables</a></h3>
<ul class="">
<li><code><a title="presalytics.lib.widgets.ooxml_editors.XML_TRANSFORM_REGISTRY" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.XML_TRANSFORM_REGISTRY">XML_TRANSFORM_REGISTRY</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="presalytics.lib.widgets.ooxml_editors.get_transform_registry" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.get_transform_registry">get_transform_registry</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="presalytics.lib.widgets.ooxml_editors.XmlTransformBase" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.XmlTransformBase">XmlTransformBase</a></code></h4>
<ul class="">
<li><code><a title="presalytics.lib.widgets.ooxml_editors.XmlTransformBase.transform_function" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.XmlTransformBase.transform_function">transform_function</a></code></li>
<li><code><a title="presalytics.lib.widgets.ooxml_editors.XmlTransformBase.execute" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.XmlTransformBase.execute">execute</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="presalytics.lib.widgets.ooxml_editors.ChangeShapeColor" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.ChangeShapeColor">ChangeShapeColor</a></code></h4>
<ul class="">
<li><code><a title="presalytics.lib.widgets.ooxml_editors.ChangeShapeColor.replace_color_on_target_shape" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.ChangeShapeColor.replace_color_on_target_shape">replace_color_on_target_shape</a></code></li>
<li><code><a title="presalytics.lib.widgets.ooxml_editors.ChangeShapeColor.transform_function" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.ChangeShapeColor.transform_function">transform_function</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="presalytics.lib.widgets.ooxml_editors.TextReplace" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.TextReplace">TextReplace</a></code></h4>
<ul class="">
<li><code><a title="presalytics.lib.widgets.ooxml_editors.TextReplace.replace_handlebars" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.TextReplace.replace_handlebars">replace_handlebars</a></code></li>
<li><code><a title="presalytics.lib.widgets.ooxml_editors.TextReplace.transform_function" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.TextReplace.transform_function">transform_function</a></code></li>
<li><code><a title="presalytics.lib.widgets.ooxml_editors.TextReplace.TextElementInfo" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.TextReplace.TextElementInfo">TextElementInfo</a></code></li>
<li><code><a title="presalytics.lib.widgets.ooxml_editors.TextReplace.TextList" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.TextReplace.TextList">TextList</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="presalytics.lib.widgets.ooxml_editors.XmlTransformRegistry" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.XmlTransformRegistry">XmlTransformRegistry</a></code></h4>
<ul class="">
<li><code><a title="presalytics.lib.widgets.ooxml_editors.XmlTransformRegistry.get_name" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.XmlTransformRegistry.get_name">get_name</a></code></li>
<li><code><a title="presalytics.lib.widgets.ooxml_editors.XmlTransformRegistry.get_type" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.XmlTransformRegistry.get_type">get_type</a></code></li>
<li><code><a title="presalytics.lib.widgets.ooxml_editors.XmlTransformRegistry.get_settings_object" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.XmlTransformRegistry.get_settings_object">get_settings_object</a></code></li>
<li><code><a title="presalytics.lib.widgets.ooxml_editors.XmlTransformRegistry.registry" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.XmlTransformRegistry.registry">registry</a></code></li>
<li><code><a title="presalytics.lib.widgets.ooxml_editors.XmlTransformRegistry.deferred_modules" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.XmlTransformRegistry.deferred_modules">deferred_modules</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="presalytics.lib.widgets.ooxml_editors.MultiXmlTransform" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.MultiXmlTransform">MultiXmlTransform</a></code></h4>
<ul class="">
<li><code><a title="presalytics.lib.widgets.ooxml_editors.MultiXmlTransform.transform_instances" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.MultiXmlTransform.transform_instances">transform_instances</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="presalytics.lib.widgets.ooxml_editors.OoxmlEditorWidget" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.OoxmlEditorWidget">OoxmlEditorWidget</a></code></h4>
<ul class="">
<li><code><a title="presalytics.lib.widgets.ooxml_editors.OoxmlEditorWidget.update_xml" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.OoxmlEditorWidget.update_xml">update_xml</a></code></li>
<li><code><a title="presalytics.lib.widgets.ooxml_editors.OoxmlEditorWidget.update" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.OoxmlEditorWidget.update">update</a></code></li>
<li><code><a title="presalytics.lib.widgets.ooxml_editors.OoxmlEditorWidget.transform" href="/python-client/presalytics/lib/widgets/ooxml_editors.html#presalytics.lib.widgets.ooxml_editors.OoxmlEditorWidget.transform">transform</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.2</a>.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>