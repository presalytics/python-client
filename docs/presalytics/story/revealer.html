<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.7.4" />
<title>presalytics.story.revealer API documentation</title>
<meta name="description" content="" />
<link href='https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css' rel='stylesheet'>
<link href='https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/8.0.0/sanitize.min.css' rel='stylesheet'>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{font-weight:bold}#index h4 + ul{margin-bottom:.6em}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>presalytics.story.revealer</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/story/revealer.py#L0-L281" class="git-link">Browse git</a>
</summary>
<pre><code class="python">import os
import shutil
import lxml.html
import webbrowser
import logging
import collections
import typing
import tempfile
import lxml
import lxml.html
import lxml.etree
import lxml.html.builder as E
import datetime
import six
import sys
import urllib.parse
import presalytics
import presalytics.lib
import presalytics.lib.plugins
import presalytics.lib.plugins.base
import presalytics.lib.plugins.reveal
import presalytics.lib.templates
import presalytics.lib.templates.base
import presalytics.story.util
import presalytics.story.server
import presalytics.story.components
import presalytics.lib.exceptions
if typing.TYPE_CHECKING:
    from presalytics.story.outline import StoryOutline, Page, Plugin
    from presalytics.story.components import PageTemplateBase, ComponentBase, WidgetBase, ThemeBase


logger = logging.getLogger(&#39;presalytics.story.revealer&#39;)


class Revealer(presalytics.story.components.Renderer):
    &#34;&#34;&#34;
    Renders `presalytics.story.outline.StoryOutline` objects to 
    [reveal.js](https://github.com/hakimel/reveal.js/) presentations

    Parameters
    ----------
    story_outline : presalytics.story.outline.StoryOutline
        The presalytics StoryOutline to be rendered and presented
    
    Attributes
    -----------
    base : lxml.etree.Element
        An etree element containing the base html for each slide

    plugins : list of dict
        Plugin data that transform to html `&lt;script&gt;` and `&lt;link&gt;` tags through
        the rendering process

    plugin_mgr : presalytics.lib.plugins.base.PluginManager
        Sorts, validates, and renders plugins

    &#34;&#34;&#34;
    base: lxml.etree.Element
    reveal_params: typing.Dict[str, typing.Any]

    __component_kind__ = &#39;revealer&#39;

    def __init__(
            self,
            story_outline: &#39;StoryOutline&#39;,
            pages: typing.List[int] = None,
            **kwargs):
        super(Revealer, self).__init__(story_outline, **kwargs)
        logger.info(&#34;Initializing story render for {}&#34;.format(story_outline.title))
        self.story_outline.validate()
        if isinstance(pages, int):
            pages = [pages]
        elif not pages:
            pages = [p for p in range(0, len(self.story_outline.pages))]
        elif not isinstance(pages, list) or not isinstance(pages[0], int):
            raise presalytics.lib.exceptions.InvalidArgumentException(message=&#39;&#34;pages&#34; must be a list of integers&#39;)
        if len([p for p in pages if p &gt;= len(self.story_outline.pages)]) &gt; 0:
            raise presalytics.lib.exceptions.InvalidArgumentException(message=&#39;&#34;pages&#34; can only contain integers lower than the number of pages in the story&#39;)
        self.pages_to_render = pages
        self.base = self._make_base()
        logger.info(&#34;Loading plugins&#34;)
        reveal_params = {}
        for key, val in kwargs.items():
            if key in presalytics.lib.plugins.reveal.RevealConfigPlugin.default_config.keys():
                reveal_params.update({key: val})
        if len(self.pages_to_render) == 1:
            reveal_params.update({&#39;controls&#39;: False})  # hide controls on single page story
        reveal_plugin_config = {
            &#39;kind&#39;: &#39;script&#39;,
            &#39;name&#39;: &#39;reveal&#39;,
            &#39;config&#39;: {&#34;reveal_params&#34;: reveal_params} if len(reveal_params.keys()) &gt; 0 else {}
        }
        overrides_config = {
            &#39;kind&#39;: &#39;style&#39;,
            &#39;name&#39;: &#39;local&#39;,
            &#39;config&#39;: {
                &#34;css_file_id&#34;: &#34;reveal_overrides&#34;
            }
        }
        self.update_outline_from_instances()
        self.plugins = [reveal_plugin_config, overrides_config]
        self.get_component_implicit_plugins()
        outline_plugins = presalytics.lib.plugins.base.PluginManager.get_plugins_from_nested_dict(source_dict=self.story_outline.to_dict())
        self.plugins.extend(outline_plugins)
        self.plugin_mgr = presalytics.lib.plugins.base.PluginManager(self.plugins)
        logger.info(&#34;Revealer initilized.&#34;)

    def _make_base(self):
        base = lxml.etree.Element(&#34;div&#34;, attrib={
            &#34;class&#34;: &#34;reveal&#34;,
        })
        lxml.etree.SubElement(base, &#34;div&#34;, attrib={&#34;class&#34;: &#34;slides&#34;})

        try:
            story_id = self.story_outline.story_id
            base.attrib[&#39;data-story-id&#39;] = story_id
        except Exception:
            logger.info(&#34;Revealer could not extract story_id from outline.&#34;)
        return base
    
    def get_meta_tags(self, body=tuple()):
        &#34;&#34;&#34;
        Security Note: If supplying a body, ensure that its already been stripped of unauthorized scripts. 
        &#34;&#34;&#34;

        scripts = body.findall(&#34;.//script&#34;)

        srcs = []
        for script in scripts:
            src = script.get(&#34;src&#34;)
            if src:
                root = urllib.parse.urlparse(src).netloc
                if root:
                    srcs.append(root)
        allowed = &#39; &#39;.join(set(srcs))

        tags = [
            &#39;&lt;meta charset=&#34;utf-8&#34;&gt;&#39;,
            &#39;&lt;meta http-equiv=&#34;X-UA-Compatible&#34; content=&#34;IE=edge&#34;&gt;&#39;,
            &#39;&lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1, shrink-to-fit=no&#34;&gt;&#39;,
        #    &#34;&#34;&#34;&lt;meta http-equiv=&#34;Content-Security-Policy&#34; content=&#34;default-src &#39;self&#39; https://*.presalytics.io; script-src &#39;self&#39; https://*.presalytics.io {0};&#34;&gt;&#34;&#34;&#34;.format(allowed)
        ]
        return tags

    def package_as_standalone(self):
        &#34;&#34;&#34;
        Render the story outline as a html document with only the 
        reveal.js presentation as conent

        Returns
        ----------
        A `str` containing a complete html document with the presentation
        &#34;&#34;&#34;
        pres = self.render()
        body = E.BODY()
        body.append(pres)
        body = self.strip_unauthorized_scripts(body)
        for scripts in self.plugin_mgr.get_scripts():
            lxml_scripts = lxml.html.fragments_fromstring(scripts)
            for item in lxml_scripts:
                body.append(item)
        head = E.HEAD()
        for meta in self.get_meta_tags(body):
            lxml_meta = lxml.html.fragment_fromstring(meta)
            head.append(lxml_meta)
        for link in self.plugin_mgr.get_styles():
            lxml_links = lxml.html.fragments_fromstring(link)
            for item in lxml_links:
                head.append(item)
        head = self.strip_unauthorized_scripts(head)
        html = E.HTML(
            head,
            body
        )
        return lxml.html.tostring(html, pretty_print=True)

    # def render_plugin(self, plugin):
    #     plugin_type = plugin[&#39;type&#39;]
    #     plugin_config = plugin[&#39;config&#39;]
    #     plugin_class = self.plugin_loader.load(plugin_type)
    #     script_string = plugin_class().to_string(plugin_config)
    #     return lxml.html.fragment_fromstring(script_string)

    def update_info(self):
        &#34;&#34;&#34;
        Updates story metadata
        &#34;&#34;&#34;
        info = self.story_outline.info
        info.date_modified = datetime.datetime.utcnow()

    def render(self):
        &#34;&#34;&#34;
        Creates a reveal.js presenation html fragement

        Returns:
        ---------
        A `str` html fragment containing a reveal.js presentation
        &#34;&#34;&#34;
        reveal_base = self.base
        for p in range(0, len(self.story_outline.pages)):
            if p in self.pages_to_render:
                page = self.story_outline.pages[p]
                slides_container = reveal_base[0]
                slide = lxml.etree.SubElement(slides_container, &#34;section&#34;)
                page_html = self.render_page(page)
                slide_fragment = lxml.html.fragment_fromstring(page_html)
                slide.append(slide_fragment)
        return reveal_base

    def render_page(self, page: &#39;Page&#39;) -&gt; str:
        &#34;&#34;&#34;
        Creates a reveal.js slide

        Returns
        ----------
        A `str` html framgment of the page
        &#34;&#34;&#34;
        class_key = &#34;page.&#34; + page.kind
        key = class_key + &#34;.&#34; + page.name
        try:
            if presalytics.COMPONENTS.get_instance(key):
                page_instance = presalytics.COMPONENTS.get_instance(key)
            else:
                klass = presalytics.COMPONENTS.get(class_key)
                deserialize_method = getattr(klass, &#34;deserialize&#34;, None)
                if callable(deserialize_method):
                    page_instance = deserialize_method(page, client_info=self.client_info)
                else:
                    message = &#39;Page component instance or class (kind) &#34;{0}&#34; unavailable in component registry&#39;.format(key)
                    raise presalytics.lib.exceptions.MissingConfigException(message)
            page_html = page_instance.render()
        except Exception as ex:
            logger.exception(ex)
            t, v, tb = sys.exc_info()
            if not presalytics.CONFIG.get(&#34;DEBUG&#34;, False):
                page_html = presalytics.lib.exceptions.RenderExceptionHandler(ex, &#34;page&#34;, traceback=tb).render_exception()
            else:
                six.reraise(t, v, tb)
        return page_html

    def present(self, files_path=None, debug=True, port=8082, host=&#39;127.0.0.1&#39;):
        &#34;&#34;&#34;
        Creates and opens the rendered story in the browser.  Story files are served by 
        a local flask server.  Not for production use.  Press Ctrl + C to close the server.

        Parameters
        ----------
        files_path : str
            filepath to a local folder that will work as root folder for a local flask
            server.  Defaults to the user&#39;s temporary files directory

        debug : str
            Defaults to True.  Indicates whether the flask server should be started
            in debug mode.
        
        port : str
            The network port to serve the story onto.  Defautls to 8082.
        
        host : str
            The host to for the local server.  Typically either localhost or the default gateway.
            Defaults to 127.0.0.1 (localhost).
        
        &#34;&#34;&#34;
        logger.info(&#34;Building story rendering at http://{0}:{1}&#34;.format(host, port))
        if not files_path:
            files_path = tempfile.gettempdir()
        logger.info(&#34;Buidling standalone package for local rendering.&#34;)
        html = self.package_as_standalone().decode(&#39;utf-8&#39;)
        id = presalytics.story.util.to_title_case(self.story_outline.title)
        if id == &#39;&#39;:
            id = &#39;blank&#39;
        server = presalytics.story.server.LocalServer(host=host, debug=debug, port=port, root_path=files_path)
        pkg_templates_dir = os.path.join(os.path.dirname(os.path.dirname(__file__)), &#34;lib&#34;, &#34;templates&#34;)
        shutil.copy(os.path.join(pkg_templates_dir, &#34;favicon.ico&#34;), os.path.join(files_path, &#34;presalytics&#34;, &#34;static&#34;))
        html_file = os.path.join(files_path, &#34;presalytics&#34;, &#34;templates&#34;, id + &#39;.html&#39;)
        with open(html_file, &#39;w&#39;) as file:
            file.write(html)
        address = &#34;http://{}:{}/story/{}&#34;.format(host, port, id)
        logger.info(&#34;Opening browser tab...&#34;)
        presalytics.story.server.Browser(address).start()
        server.run()</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="presalytics.story.revealer.Revealer"><code class="flex name class">
<span>class <span class="ident">Revealer</span></span>
<span>(</span><span>story_outline, pages=None, **kwargs)</span>
</code></dt>
<dd>
<section class="desc"><p>Renders <a title="presalytics.story.outline.StoryOutline" href="/python-client/presalytics/story/outline.html#presalytics.story.outline.StoryOutline"><code>StoryOutline</code></a> objects to
<a href="https://github.com/hakimel/reveal.js/">reveal.js</a> presentations</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>story_outline</code></strong> :&ensp;<a title="presalytics.story.outline.StoryOutline" href="/python-client/presalytics/story/outline.html#presalytics.story.outline.StoryOutline"><code>StoryOutline</code></a></dt>
<dd>The presalytics StoryOutline to be rendered and presented</dd>
</dl>
<h2 id="attributes">Attributes</h2>
<dl>
<dt><strong><code>base</code></strong> :&ensp;<code>lxml.etree.Element</code></dt>
<dd>An etree element containing the base html for each slide</dd>
<dt><strong><code>plugins</code></strong> :&ensp;<code>list</code> of <code>dict</code></dt>
<dd>Plugin data that transform to html <code>&lt;script&gt;</code> and <code>&lt;link&gt;</code> tags through
the rendering process</dd>
<dt><strong><code>plugin_mgr</code></strong> :&ensp;<a title="presalytics.lib.plugins.base.PluginManager" href="/python-client/presalytics/lib/plugins/base.html#presalytics.lib.plugins.base.PluginManager"><code>PluginManager</code></a></dt>
<dd>Sorts, validates, and renders plugins</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/story/revealer.py#L36-L282" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class Revealer(presalytics.story.components.Renderer):
    &#34;&#34;&#34;
    Renders `presalytics.story.outline.StoryOutline` objects to 
    [reveal.js](https://github.com/hakimel/reveal.js/) presentations

    Parameters
    ----------
    story_outline : presalytics.story.outline.StoryOutline
        The presalytics StoryOutline to be rendered and presented
    
    Attributes
    -----------
    base : lxml.etree.Element
        An etree element containing the base html for each slide

    plugins : list of dict
        Plugin data that transform to html `&lt;script&gt;` and `&lt;link&gt;` tags through
        the rendering process

    plugin_mgr : presalytics.lib.plugins.base.PluginManager
        Sorts, validates, and renders plugins

    &#34;&#34;&#34;
    base: lxml.etree.Element
    reveal_params: typing.Dict[str, typing.Any]

    __component_kind__ = &#39;revealer&#39;

    def __init__(
            self,
            story_outline: &#39;StoryOutline&#39;,
            pages: typing.List[int] = None,
            **kwargs):
        super(Revealer, self).__init__(story_outline, **kwargs)
        logger.info(&#34;Initializing story render for {}&#34;.format(story_outline.title))
        self.story_outline.validate()
        if isinstance(pages, int):
            pages = [pages]
        elif not pages:
            pages = [p for p in range(0, len(self.story_outline.pages))]
        elif not isinstance(pages, list) or not isinstance(pages[0], int):
            raise presalytics.lib.exceptions.InvalidArgumentException(message=&#39;&#34;pages&#34; must be a list of integers&#39;)
        if len([p for p in pages if p &gt;= len(self.story_outline.pages)]) &gt; 0:
            raise presalytics.lib.exceptions.InvalidArgumentException(message=&#39;&#34;pages&#34; can only contain integers lower than the number of pages in the story&#39;)
        self.pages_to_render = pages
        self.base = self._make_base()
        logger.info(&#34;Loading plugins&#34;)
        reveal_params = {}
        for key, val in kwargs.items():
            if key in presalytics.lib.plugins.reveal.RevealConfigPlugin.default_config.keys():
                reveal_params.update({key: val})
        if len(self.pages_to_render) == 1:
            reveal_params.update({&#39;controls&#39;: False})  # hide controls on single page story
        reveal_plugin_config = {
            &#39;kind&#39;: &#39;script&#39;,
            &#39;name&#39;: &#39;reveal&#39;,
            &#39;config&#39;: {&#34;reveal_params&#34;: reveal_params} if len(reveal_params.keys()) &gt; 0 else {}
        }
        overrides_config = {
            &#39;kind&#39;: &#39;style&#39;,
            &#39;name&#39;: &#39;local&#39;,
            &#39;config&#39;: {
                &#34;css_file_id&#34;: &#34;reveal_overrides&#34;
            }
        }
        self.update_outline_from_instances()
        self.plugins = [reveal_plugin_config, overrides_config]
        self.get_component_implicit_plugins()
        outline_plugins = presalytics.lib.plugins.base.PluginManager.get_plugins_from_nested_dict(source_dict=self.story_outline.to_dict())
        self.plugins.extend(outline_plugins)
        self.plugin_mgr = presalytics.lib.plugins.base.PluginManager(self.plugins)
        logger.info(&#34;Revealer initilized.&#34;)

    def _make_base(self):
        base = lxml.etree.Element(&#34;div&#34;, attrib={
            &#34;class&#34;: &#34;reveal&#34;,
        })
        lxml.etree.SubElement(base, &#34;div&#34;, attrib={&#34;class&#34;: &#34;slides&#34;})

        try:
            story_id = self.story_outline.story_id
            base.attrib[&#39;data-story-id&#39;] = story_id
        except Exception:
            logger.info(&#34;Revealer could not extract story_id from outline.&#34;)
        return base
    
    def get_meta_tags(self, body=tuple()):
        &#34;&#34;&#34;
        Security Note: If supplying a body, ensure that its already been stripped of unauthorized scripts. 
        &#34;&#34;&#34;

        scripts = body.findall(&#34;.//script&#34;)

        srcs = []
        for script in scripts:
            src = script.get(&#34;src&#34;)
            if src:
                root = urllib.parse.urlparse(src).netloc
                if root:
                    srcs.append(root)
        allowed = &#39; &#39;.join(set(srcs))

        tags = [
            &#39;&lt;meta charset=&#34;utf-8&#34;&gt;&#39;,
            &#39;&lt;meta http-equiv=&#34;X-UA-Compatible&#34; content=&#34;IE=edge&#34;&gt;&#39;,
            &#39;&lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1, shrink-to-fit=no&#34;&gt;&#39;,
        #    &#34;&#34;&#34;&lt;meta http-equiv=&#34;Content-Security-Policy&#34; content=&#34;default-src &#39;self&#39; https://*.presalytics.io; script-src &#39;self&#39; https://*.presalytics.io {0};&#34;&gt;&#34;&#34;&#34;.format(allowed)
        ]
        return tags

    def package_as_standalone(self):
        &#34;&#34;&#34;
        Render the story outline as a html document with only the 
        reveal.js presentation as conent

        Returns
        ----------
        A `str` containing a complete html document with the presentation
        &#34;&#34;&#34;
        pres = self.render()
        body = E.BODY()
        body.append(pres)
        body = self.strip_unauthorized_scripts(body)
        for scripts in self.plugin_mgr.get_scripts():
            lxml_scripts = lxml.html.fragments_fromstring(scripts)
            for item in lxml_scripts:
                body.append(item)
        head = E.HEAD()
        for meta in self.get_meta_tags(body):
            lxml_meta = lxml.html.fragment_fromstring(meta)
            head.append(lxml_meta)
        for link in self.plugin_mgr.get_styles():
            lxml_links = lxml.html.fragments_fromstring(link)
            for item in lxml_links:
                head.append(item)
        head = self.strip_unauthorized_scripts(head)
        html = E.HTML(
            head,
            body
        )
        return lxml.html.tostring(html, pretty_print=True)

    # def render_plugin(self, plugin):
    #     plugin_type = plugin[&#39;type&#39;]
    #     plugin_config = plugin[&#39;config&#39;]
    #     plugin_class = self.plugin_loader.load(plugin_type)
    #     script_string = plugin_class().to_string(plugin_config)
    #     return lxml.html.fragment_fromstring(script_string)

    def update_info(self):
        &#34;&#34;&#34;
        Updates story metadata
        &#34;&#34;&#34;
        info = self.story_outline.info
        info.date_modified = datetime.datetime.utcnow()

    def render(self):
        &#34;&#34;&#34;
        Creates a reveal.js presenation html fragement

        Returns:
        ---------
        A `str` html fragment containing a reveal.js presentation
        &#34;&#34;&#34;
        reveal_base = self.base
        for p in range(0, len(self.story_outline.pages)):
            if p in self.pages_to_render:
                page = self.story_outline.pages[p]
                slides_container = reveal_base[0]
                slide = lxml.etree.SubElement(slides_container, &#34;section&#34;)
                page_html = self.render_page(page)
                slide_fragment = lxml.html.fragment_fromstring(page_html)
                slide.append(slide_fragment)
        return reveal_base

    def render_page(self, page: &#39;Page&#39;) -&gt; str:
        &#34;&#34;&#34;
        Creates a reveal.js slide

        Returns
        ----------
        A `str` html framgment of the page
        &#34;&#34;&#34;
        class_key = &#34;page.&#34; + page.kind
        key = class_key + &#34;.&#34; + page.name
        try:
            if presalytics.COMPONENTS.get_instance(key):
                page_instance = presalytics.COMPONENTS.get_instance(key)
            else:
                klass = presalytics.COMPONENTS.get(class_key)
                deserialize_method = getattr(klass, &#34;deserialize&#34;, None)
                if callable(deserialize_method):
                    page_instance = deserialize_method(page, client_info=self.client_info)
                else:
                    message = &#39;Page component instance or class (kind) &#34;{0}&#34; unavailable in component registry&#39;.format(key)
                    raise presalytics.lib.exceptions.MissingConfigException(message)
            page_html = page_instance.render()
        except Exception as ex:
            logger.exception(ex)
            t, v, tb = sys.exc_info()
            if not presalytics.CONFIG.get(&#34;DEBUG&#34;, False):
                page_html = presalytics.lib.exceptions.RenderExceptionHandler(ex, &#34;page&#34;, traceback=tb).render_exception()
            else:
                six.reraise(t, v, tb)
        return page_html

    def present(self, files_path=None, debug=True, port=8082, host=&#39;127.0.0.1&#39;):
        &#34;&#34;&#34;
        Creates and opens the rendered story in the browser.  Story files are served by 
        a local flask server.  Not for production use.  Press Ctrl + C to close the server.

        Parameters
        ----------
        files_path : str
            filepath to a local folder that will work as root folder for a local flask
            server.  Defaults to the user&#39;s temporary files directory

        debug : str
            Defaults to True.  Indicates whether the flask server should be started
            in debug mode.
        
        port : str
            The network port to serve the story onto.  Defautls to 8082.
        
        host : str
            The host to for the local server.  Typically either localhost or the default gateway.
            Defaults to 127.0.0.1 (localhost).
        
        &#34;&#34;&#34;
        logger.info(&#34;Building story rendering at http://{0}:{1}&#34;.format(host, port))
        if not files_path:
            files_path = tempfile.gettempdir()
        logger.info(&#34;Buidling standalone package for local rendering.&#34;)
        html = self.package_as_standalone().decode(&#39;utf-8&#39;)
        id = presalytics.story.util.to_title_case(self.story_outline.title)
        if id == &#39;&#39;:
            id = &#39;blank&#39;
        server = presalytics.story.server.LocalServer(host=host, debug=debug, port=port, root_path=files_path)
        pkg_templates_dir = os.path.join(os.path.dirname(os.path.dirname(__file__)), &#34;lib&#34;, &#34;templates&#34;)
        shutil.copy(os.path.join(pkg_templates_dir, &#34;favicon.ico&#34;), os.path.join(files_path, &#34;presalytics&#34;, &#34;static&#34;))
        html_file = os.path.join(files_path, &#34;presalytics&#34;, &#34;templates&#34;, id + &#39;.html&#39;)
        with open(html_file, &#39;w&#39;) as file:
            file.write(html)
        address = &#34;http://{}:{}/story/{}&#34;.format(host, port, id)
        logger.info(&#34;Opening browser tab...&#34;)
        presalytics.story.server.Browser(address).start()
        server.run()</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="presalytics.story.components.Renderer" href="/python-client/presalytics/story/components.html#presalytics.story.components.Renderer">Renderer</a></li>
<li><a title="presalytics.story.components.ComponentBase" href="/python-client/presalytics/story/components.html#presalytics.story.components.ComponentBase">ComponentBase</a></li>
<li>abc.ABC</li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="presalytics.story.revealer.Revealer.get_meta_tags"><code class="name flex">
<span>def <span class="ident">get_meta_tags</span></span>(<span>self, body=())</span>
</code></dt>
<dd>
<section class="desc"><p>Security Note: If supplying a body, ensure that its already been stripped of unauthorized scripts.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/story/revealer.py#L122-L144" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def get_meta_tags(self, body=tuple()):
    &#34;&#34;&#34;
    Security Note: If supplying a body, ensure that its already been stripped of unauthorized scripts. 
    &#34;&#34;&#34;

    scripts = body.findall(&#34;.//script&#34;)

    srcs = []
    for script in scripts:
        src = script.get(&#34;src&#34;)
        if src:
            root = urllib.parse.urlparse(src).netloc
            if root:
                srcs.append(root)
    allowed = &#39; &#39;.join(set(srcs))

    tags = [
        &#39;&lt;meta charset=&#34;utf-8&#34;&gt;&#39;,
        &#39;&lt;meta http-equiv=&#34;X-UA-Compatible&#34; content=&#34;IE=edge&#34;&gt;&#39;,
        &#39;&lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1, shrink-to-fit=no&#34;&gt;&#39;,
    #    &#34;&#34;&#34;&lt;meta http-equiv=&#34;Content-Security-Policy&#34; content=&#34;default-src &#39;self&#39; https://*.presalytics.io; script-src &#39;self&#39; https://*.presalytics.io {0};&#34;&gt;&#34;&#34;&#34;.format(allowed)
    ]
    return tags</code></pre>
</details>
</dd>
<dt id="presalytics.story.revealer.Revealer.package_as_standalone"><code class="name flex">
<span>def <span class="ident">package_as_standalone</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>Render the story outline as a html document with only the
reveal.js presentation as conent</p>
<h2 id="returns">Returns</h2>
<p>A <code>str</code> containing a complete html document with the presentation</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/story/revealer.py#L146-L176" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def package_as_standalone(self):
    &#34;&#34;&#34;
    Render the story outline as a html document with only the 
    reveal.js presentation as conent

    Returns
    ----------
    A `str` containing a complete html document with the presentation
    &#34;&#34;&#34;
    pres = self.render()
    body = E.BODY()
    body.append(pres)
    body = self.strip_unauthorized_scripts(body)
    for scripts in self.plugin_mgr.get_scripts():
        lxml_scripts = lxml.html.fragments_fromstring(scripts)
        for item in lxml_scripts:
            body.append(item)
    head = E.HEAD()
    for meta in self.get_meta_tags(body):
        lxml_meta = lxml.html.fragment_fromstring(meta)
        head.append(lxml_meta)
    for link in self.plugin_mgr.get_styles():
        lxml_links = lxml.html.fragments_fromstring(link)
        for item in lxml_links:
            head.append(item)
    head = self.strip_unauthorized_scripts(head)
    html = E.HTML(
        head,
        body
    )
    return lxml.html.tostring(html, pretty_print=True)</code></pre>
</details>
</dd>
<dt id="presalytics.story.revealer.Revealer.update_info"><code class="name flex">
<span>def <span class="ident">update_info</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>Updates story metadata</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/story/revealer.py#L185-L190" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def update_info(self):
    &#34;&#34;&#34;
    Updates story metadata
    &#34;&#34;&#34;
    info = self.story_outline.info
    info.date_modified = datetime.datetime.utcnow()</code></pre>
</details>
</dd>
<dt id="presalytics.story.revealer.Revealer.render"><code class="name flex">
<span>def <span class="ident">render</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>Creates a reveal.js presenation html fragement</p>
<h2 id="returns">Returns:</h2>
<p>A <code>str</code> html fragment containing a reveal.js presentation</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/story/revealer.py#L192-L209" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def render(self):
    &#34;&#34;&#34;
    Creates a reveal.js presenation html fragement

    Returns:
    ---------
    A `str` html fragment containing a reveal.js presentation
    &#34;&#34;&#34;
    reveal_base = self.base
    for p in range(0, len(self.story_outline.pages)):
        if p in self.pages_to_render:
            page = self.story_outline.pages[p]
            slides_container = reveal_base[0]
            slide = lxml.etree.SubElement(slides_container, &#34;section&#34;)
            page_html = self.render_page(page)
            slide_fragment = lxml.html.fragment_fromstring(page_html)
            slide.append(slide_fragment)
    return reveal_base</code></pre>
</details>
</dd>
<dt id="presalytics.story.revealer.Revealer.render_page"><code class="name flex">
<span>def <span class="ident">render_page</span></span>(<span>self, page)</span>
</code></dt>
<dd>
<section class="desc"><p>Creates a reveal.js slide</p>
<h2 id="returns">Returns</h2>
<p>A <code>str</code> html framgment of the page</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/story/revealer.py#L211-L240" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def render_page(self, page: &#39;Page&#39;) -&gt; str:
    &#34;&#34;&#34;
    Creates a reveal.js slide

    Returns
    ----------
    A `str` html framgment of the page
    &#34;&#34;&#34;
    class_key = &#34;page.&#34; + page.kind
    key = class_key + &#34;.&#34; + page.name
    try:
        if presalytics.COMPONENTS.get_instance(key):
            page_instance = presalytics.COMPONENTS.get_instance(key)
        else:
            klass = presalytics.COMPONENTS.get(class_key)
            deserialize_method = getattr(klass, &#34;deserialize&#34;, None)
            if callable(deserialize_method):
                page_instance = deserialize_method(page, client_info=self.client_info)
            else:
                message = &#39;Page component instance or class (kind) &#34;{0}&#34; unavailable in component registry&#39;.format(key)
                raise presalytics.lib.exceptions.MissingConfigException(message)
        page_html = page_instance.render()
    except Exception as ex:
        logger.exception(ex)
        t, v, tb = sys.exc_info()
        if not presalytics.CONFIG.get(&#34;DEBUG&#34;, False):
            page_html = presalytics.lib.exceptions.RenderExceptionHandler(ex, &#34;page&#34;, traceback=tb).render_exception()
        else:
            six.reraise(t, v, tb)
    return page_html</code></pre>
</details>
</dd>
<dt id="presalytics.story.revealer.Revealer.present"><code class="name flex">
<span>def <span class="ident">present</span></span>(<span>self, files_path=None, debug=True, port=8082, host='127.0.0.1')</span>
</code></dt>
<dd>
<section class="desc"><p>Creates and opens the rendered story in the browser.
Story files are served by
a local flask server.
Not for production use.
Press Ctrl + C to close the server.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>files_path</code></strong> :&ensp;<code>str</code></dt>
<dd>filepath to a local folder that will work as root folder for a local flask
server.
Defaults to the user's temporary files directory</dd>
<dt><strong><code>debug</code></strong> :&ensp;<code>str</code></dt>
<dd>Defaults to True.
Indicates whether the flask server should be started
in debug mode.</dd>
<dt><strong><code>port</code></strong> :&ensp;<code>str</code></dt>
<dd>The network port to serve the story onto.
Defautls to 8082.</dd>
<dt><strong><code>host</code></strong> :&ensp;<code>str</code></dt>
<dd>The host to for the local server.
Typically either localhost or the default gateway.
Defaults to 127.0.0.1 (localhost).</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/presalytics/python-client/blob/master/presalytics/story/revealer.py#L242-L282" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def present(self, files_path=None, debug=True, port=8082, host=&#39;127.0.0.1&#39;):
    &#34;&#34;&#34;
    Creates and opens the rendered story in the browser.  Story files are served by 
    a local flask server.  Not for production use.  Press Ctrl + C to close the server.

    Parameters
    ----------
    files_path : str
        filepath to a local folder that will work as root folder for a local flask
        server.  Defaults to the user&#39;s temporary files directory

    debug : str
        Defaults to True.  Indicates whether the flask server should be started
        in debug mode.
    
    port : str
        The network port to serve the story onto.  Defautls to 8082.
    
    host : str
        The host to for the local server.  Typically either localhost or the default gateway.
        Defaults to 127.0.0.1 (localhost).
    
    &#34;&#34;&#34;
    logger.info(&#34;Building story rendering at http://{0}:{1}&#34;.format(host, port))
    if not files_path:
        files_path = tempfile.gettempdir()
    logger.info(&#34;Buidling standalone package for local rendering.&#34;)
    html = self.package_as_standalone().decode(&#39;utf-8&#39;)
    id = presalytics.story.util.to_title_case(self.story_outline.title)
    if id == &#39;&#39;:
        id = &#39;blank&#39;
    server = presalytics.story.server.LocalServer(host=host, debug=debug, port=port, root_path=files_path)
    pkg_templates_dir = os.path.join(os.path.dirname(os.path.dirname(__file__)), &#34;lib&#34;, &#34;templates&#34;)
    shutil.copy(os.path.join(pkg_templates_dir, &#34;favicon.ico&#34;), os.path.join(files_path, &#34;presalytics&#34;, &#34;static&#34;))
    html_file = os.path.join(files_path, &#34;presalytics&#34;, &#34;templates&#34;, id + &#39;.html&#39;)
    with open(html_file, &#39;w&#39;) as file:
        file.write(html)
    address = &#34;http://{}:{}/story/{}&#34;.format(host, port, id)
    logger.info(&#34;Opening browser tab...&#34;)
    presalytics.story.server.Browser(address).start()
    server.run()</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="presalytics.story.components.Renderer" href="/python-client/presalytics/story/components.html#presalytics.story.components.Renderer">Renderer</a></b></code>:
<ul class="hlist">
<li><code><a title="presalytics.story.components.Renderer.deserialize" href="/python-client/presalytics/story/components.html#presalytics.story.components.Renderer.deserialize">deserialize</a></code></li>
<li><code><a title="presalytics.story.components.Renderer.get_client" href="/python-client/presalytics/story/components.html#presalytics.story.components.ComponentBase.get_client">get_client</a></code></li>
<li><code><a title="presalytics.story.components.Renderer.get_component_implicit_plugins" href="/python-client/presalytics/story/components.html#presalytics.story.components.Renderer.get_component_implicit_plugins">get_component_implicit_plugins</a></code></li>
<li><code><a title="presalytics.story.components.Renderer.manage" href="/python-client/presalytics/story/components.html#presalytics.story.components.Renderer.manage">manage</a></code></li>
<li><code><a title="presalytics.story.components.Renderer.serialize" href="/python-client/presalytics/story/components.html#presalytics.story.components.Renderer.serialize">serialize</a></code></li>
<li><code><a title="presalytics.story.components.Renderer.strip_unauthorized_scripts" href="/python-client/presalytics/story/components.html#presalytics.story.components.Renderer.strip_unauthorized_scripts">strip_unauthorized_scripts</a></code></li>
<li><code><a title="presalytics.story.components.Renderer.update_outline_from_instances" href="/python-client/presalytics/story/components.html#presalytics.story.components.Renderer.update_outline_from_instances">update_outline_from_instances</a></code></li>
<li><code><a title="presalytics.story.components.Renderer.update_story" href="/python-client/presalytics/story/components.html#presalytics.story.components.Renderer.update_story">update_story</a></code></li>
<li><code><a title="presalytics.story.components.Renderer.view" href="/python-client/presalytics/story/components.html#presalytics.story.components.Renderer.view">view</a></code></li>
</ul>
</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="presalytics.story" href="/python-client/presalytics/story/index.html">presalytics.story</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="presalytics.story.revealer.Revealer" href="/python-client/presalytics/story/revealer.html#presalytics.story.revealer.Revealer">Revealer</a></code></h4>
<ul class="">
<li><code><a title="presalytics.story.revealer.Revealer.get_meta_tags" href="/python-client/presalytics/story/revealer.html#presalytics.story.revealer.Revealer.get_meta_tags">get_meta_tags</a></code></li>
<li><code><a title="presalytics.story.revealer.Revealer.package_as_standalone" href="/python-client/presalytics/story/revealer.html#presalytics.story.revealer.Revealer.package_as_standalone">package_as_standalone</a></code></li>
<li><code><a title="presalytics.story.revealer.Revealer.update_info" href="/python-client/presalytics/story/revealer.html#presalytics.story.revealer.Revealer.update_info">update_info</a></code></li>
<li><code><a title="presalytics.story.revealer.Revealer.render" href="/python-client/presalytics/story/revealer.html#presalytics.story.revealer.Revealer.render">render</a></code></li>
<li><code><a title="presalytics.story.revealer.Revealer.render_page" href="/python-client/presalytics/story/revealer.html#presalytics.story.revealer.Revealer.render_page">render_page</a></code></li>
<li><code><a title="presalytics.story.revealer.Revealer.present" href="/python-client/presalytics/story/revealer.html#presalytics.story.revealer.Revealer.present">present</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.7.4</a>.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>